rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.5, yend=-0.5, x=min(params$rec.tran), end=max(params$rec.tran)))+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.5,1))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.5, yend=-0.5, x=min(params$rec.tran), xend=max(params$rec.tran)))+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.5,1))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.5, yend=-0.5, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.5,1))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.5, yend=-0.5, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.5,1))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.5, yend=-0.5, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.5,1))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.5, yend=-0.5, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.6,1))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,1))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.75))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
arrows$Common2[arrows$morphology=="tabular"] <- 9*10^-05#
arrows$Common2[arrows$morphology=="staghorn"] <- 5.5*10^-04 #
#
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot#
#
GTplot<- ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=log(lam.sd1), yend=log(lam.sd2), col=spp), size=0.5)+#
geom_segment(data=params, aes(x=GT.sd1, xend=GT.sd2, y=log(lam.mn), yend=log(lam.mn), col=spp), size=0.5)+#
geom_point(data=params, aes(GT, log(lam.mn),col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_text(data=params[params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
geom_point(data=params, aes(GT, log(lam.mn), col=spp), size=3, alpha=0.5)+#
#geom_point(shape=21, aes(col=spp), alpha=0.2)+#
#coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+#
scale_fill_manual(values=cols)+#
scale_x_log10()+#
geom_text(data=params[!params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
guides(col="none", fill="none")+#
theme_classic()+#
ggtitle("Generation times")+#
labs(x="Generation Time (years)", y=expression(log(lambda)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))#
GTplot#
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.4,-0.05,1, 0.9), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete=c(expand=c(1,1))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete(expand=c(1,1))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete(expand=c(0.1,0.1))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete(expand=c(0.5,0.5))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete(expand=c(0.3,0.3))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot
GTplot<- ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=log(lam.sd1), yend=log(lam.sd2), col=spp), size=0.5)+#
geom_segment(data=params, aes(x=GT.sd1, xend=GT.sd2, y=log(lam.mn), yend=log(lam.mn), col=spp), size=0.5)+#
geom_point(data=params, aes(GT, log(lam.mn),col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_text(data=params[params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
geom_point(data=params, aes(GT, log(lam.mn), col=spp), size=3, alpha=0.5)+#
#geom_point(shape=21, aes(col=spp), alpha=0.2)+#
#coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+#
scale_fill_manual(values=cols)+#
scale_x_log10()+#
geom_text(data=params[!params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
guides(col="none", fill="none")+#
theme_classic()+#
ggtitle("Generation times")+#
labs(x="Generation Time (years)", y=expression(log(lambda)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))#
GTplot#
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.4,-0.05,1, 0.9), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.4,-0.05,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.4,-0.08,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.4,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
lam.dens <- plot_grid(NULL, ggplot(boot)+#
geom_segment(data=arrows2, aes(x=-Inf, xend=Inf, y=yaxis*1.2, yend=yaxis*1.2), col="white")+#
geom_segment(data=arrows2, aes(y=yaxis, yend=yaxis, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
geom_text(data=lab.point, aes(x,y, label=lab), size=1.8, hjust=0, nudge_y=0.3)+#
geom_density(aes(x=log(lam), col=spp, fill=spp), alpha=0.5)+#
geom_vline(xintercept=0, linetype="dotted")+#
geom_point(data=params, aes(log.lam3, yaxis,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(log.lam3, yaxis, col=spp), size=3, alpha=0.5)+#
geom_text(data=params[!params$spp=="Ana",], aes(log.lam3, yaxis, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(log.lam3, yaxis, label="D"), size=1.8, fontface="bold")+#
#geom_hline(yintercept=0, size=1, col="white")+#
geom_hline(yintercept=-0.1, size=1, col="black")+#
#scale_y_sqrt(expand=c(0,0))+#
scale_y_continuous(expand=c(0,0))+#
#lims(x=c(min(boot$lam), max(boot$lam)))+#
ggtitle(expression(bold(Fitness)))+#
xlim(c(min(log(boot$lam)), max(log(boot$lam))-0.02))+#
coord_cartesian(xlim=c(-0.5, max(log(boot$lam))))+#
#scale_x_log10(limits=c(min(boot$lam), max(boot$lam)))+#
facet_wrap(~morphology, ncol=1, scales="free_y", strip.position="left")+#
labs(y="Density", x=expression(log(lambda)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
theme_classic()+theme(strip.text=element_blank(), strip.background=element_blank(), axis.text.y=element_blank(), axis.title.y=element_blank(), axis.line.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold")), nrow=1, rel_widths=c(0.1,1))#
lam.dens
source("figs/supp.fig3.R")#
#
examples1 <- #
plot_grid(NULL, plot_grid(NULL, #
plots[["Ahy"]]+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical",legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
NULL,#
plots[["Ahu"]]+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical",legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),NULL,#
#guides(col="none",fill="none")#
ncol=1, rel_heights=c(0.35,1,-0.1,1,0.1))+#
draw_label(expression(size[" "*t]~(m^2)), 0.65, 0.08, size=8, hjust=1)+#
draw_label(expression(size[" "*t+1]~(m^2)), -0.05, 0.55, size=8, angle=90)+#
draw_label("Example IPMs", 0.45, 0.95, fontface="bold", size=8)+#
draw_label(expression("("*bold(before)~bolditalic(P[rec])*")"), 0.45, 0.9, fontface="bold", size=8),#
nrow=1, rel_widths=c(0.12,1))#
examples1#
#
examples2 <- #
plot_grid(NULL,plot_grid(NULL,#
plots[["Ahy"]]+ggtitle("Ahy")+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical",legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
plots[["Ahu"]]+ggtitle("Adi")+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical", legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
nrow=1, rel_widths=c(0.2,1,1))+#
draw_label(expression(size[" "*t]~(m^2)), 0.6, 0.14, size=8, hjust=1)+#
draw_label(expression(size[" "*t+1]~(m^2)), 0.06, 0.65, size=8, angle=90)+#
draw_label(expression(bold(Example~IPMs~(before~bolditalic(P[rec])))), 0.55, 1.05, fontface="bold", size=8), nrow=2, rel_heights=c(0.15,1))#
examples2#
#
params$lam.est3 <- aggregate(lam~spp, boot, median)$lam#
params$log.lam3 <- log(params$lam.est)#
arrows2 <- dcast(params[!params$spp=="Ana", ], morphology~abundance_pair,  value.var="log.lam3")#
arrows2$Common2 <- arrows2$Common-0.03#
arrows2$Rare2 <- arrows2$Rare+0.02#
params$AB <- ifelse(params$abundance_pair=="Rare","R","C")#
boot$morphology <- params$morphology[match(boot$spp, params$spp)]#
morph.ord <- c("massive","digitate","corymbose","staghorn","tabular")#
boot$morphology <- factor(boot$morphology, levels=morph.ord)#
arrows2$morphology <- factor(arrows2$morphology, levels=morph.ord)#
params$morphology <- factor(params$morphology, levels=morph.ord)#
#
#arrows2$yaxis <- c(15, 30,38,13,13)#
arrows2$yaxis <- c(38, 30,15,13,13)#
params$yaxis <- arrows2$yaxis[match(params$morphology, arrows2$morphology)]#
arrows2#
#
arrows2$diff <- arrows2$Common - arrows2$Rare#
#
lab.point <- data.frame(morphology="massive", x=c(0.2, 0.2, 0.2), y=c(30, 20, 10), lab = c('C = Common','R = Rare','D = Declined'))#
lab.point$morphology <- factor(lab.point$morphology, levels=morph.ord)#
#
params$log.lam3[params$spp=="Ana"]<-#
params$log.lam3[params$spp=="Ana"]+0.02#
params$log.lam3[params$spp=="Ami"]<-#
params$log.lam3[params$spp=="Ami"]-0.02#
lam.dens <- plot_grid(NULL, ggplot(boot)+#
geom_segment(data=arrows2, aes(x=-Inf, xend=Inf, y=yaxis*1.2, yend=yaxis*1.2), col="white")+#
geom_segment(data=arrows2, aes(y=yaxis, yend=yaxis, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
geom_text(data=lab.point, aes(x,y, label=lab), size=1.8, hjust=0, nudge_y=0.3)+#
geom_density(aes(x=log(lam), col=spp, fill=spp), alpha=0.5)+#
geom_vline(xintercept=0, linetype="dotted")+#
geom_point(data=params, aes(log.lam3, yaxis,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(log.lam3, yaxis, col=spp), size=3, alpha=0.5)+#
geom_text(data=params[!params$spp=="Ana",], aes(log.lam3, yaxis, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(log.lam3, yaxis, label="D"), size=1.8, fontface="bold")+#
#geom_hline(yintercept=0, size=1, col="white")+#
geom_hline(yintercept=-0.1, size=1, col="black")+#
#scale_y_sqrt(expand=c(0,0))+#
scale_y_continuous(expand=c(0,0))+#
#lims(x=c(min(boot$lam), max(boot$lam)))+#
ggtitle(expression(bold(Fitness)))+#
xlim(c(min(log(boot$lam)), max(log(boot$lam))-0.02))+#
coord_cartesian(xlim=c(-0.5, max(log(boot$lam))))+#
#scale_x_log10(limits=c(min(boot$lam), max(boot$lam)))+#
facet_wrap(~morphology, ncol=1, scales="free_y", strip.position="left")+#
labs(y="Density", x=expression(log(lambda)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
theme_classic()+theme(strip.text=element_blank(), strip.background=element_blank(), axis.text.y=element_blank(), axis.title.y=element_blank(), axis.line.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold")), nrow=1, rel_widths=c(0.1,1))#
lam.dens#
#
plot_grid(examples1, lam.dens, nrow=1, rel_widths=c(0.5, 1))#
#
r.long$label <-ifelse(r.long$variable=="rec.tran", "Transects","Constant")#
#r.long$label <- factor(r.long$label, levels=c("Fitted","Constant"))#
params$genus <- ifelse(params$family=="Acroporidae", "Acr","Gon")#
#
params$AB <- ifelse(params$abundance_pair=="Rare","R","C")#
#
arrows <- dcast(params[!params$spp=="Ana", ], morphology~abundance_pair,  value.var="rec.one")#
arrows$Common2 <- 10^(log10(arrows$Common)+0.2)#
arrows$Rare2 <- arrows$Rare#
arrows[arrows$morphology %in% c("staghorn", "tabular"),c("Rare2","Common2")] <- arrows[arrows$morphology %in% c("staghorn", "tabular"),c("Rare","Common")]#
#
arrows$diff <-   arrows$Rare/arrows$Common#
storeDET2 <- storeDET[storeDET$rec>1*10^-5 & storeDET$rec<2*10^-1,]
fitplot <- ggplot()+geom_line(data=params,aes(x=rec.tran,y=1))+#
geom_segment(data=NULL, aes(x=min(params$rec.tran), xend=min(params$rec.tran), y=1, yend=0.98))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=1.05), label=expression(italic(P[rec])~~range), hjust=0.2, size=2.5)+#
geom_segment(data=NULL, aes(x=max(params$rec.tran), xend=max(params$rec.tran), y=1, yend=0.98))+ylim(c(0.94,1.2))+#
ggtitle("Recruitment vs fitness")+scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)))+theme_void()+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))
fitplot
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.2, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.2, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.2, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title.x=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.2, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
GTplot<- ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=log(lam.sd1), yend=log(lam.sd2), col=spp), size=0.5)+#
geom_segment(data=params, aes(x=GT.sd1, xend=GT.sd2, y=log(lam.mn), yend=log(lam.mn), col=spp), size=0.5)+#
geom_point(data=params, aes(GT, log(lam.mn),col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_text(data=params[params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
geom_point(data=params, aes(GT, log(lam.mn), col=spp), size=3, alpha=0.5)+#
#geom_point(shape=21, aes(col=spp), alpha=0.2)+#
#coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+#
scale_fill_manual(values=cols)+#
scale_x_log10()+#
geom_text(data=params[!params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
guides(col="none", fill="none")+#
theme_classic()+#
ggtitle("Generation times")+#
labs(x="Generation Time (years)", y=expression(log(lambda)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"), axis.title=element_text(size=9), axis.text=element_text(size=8))#
GTplot
#arrows2$yaxis <- c(15, 30,38,13,13)#
arrows2$yaxis <- c(38, 30,15,13,13)#
params$yaxis <- arrows2$yaxis[match(params$morphology, arrows2$morphology)]#
arrows2
examples2 <- #
plot_grid(NULL,plot_grid(NULL,#
plots[["Ahy"]]+ggtitle("Ahy")+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical",legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
plots[["Ahu"]]+ggtitle("Adi")+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical", legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
nrow=1, rel_widths=c(0.2,1,1))+#
draw_label(expression(size[" "*t]~(m^2)), 0.6, 0.14, size=8, hjust=1)+#
draw_label(expression(size[" "*t+1]~(m^2)), 0.06, 0.65, size=8, angle=90)+#
draw_label(expression(bold(Example~IPMs~(before~bolditalic(P[rec])))), 0.55, 1.05, fontface="bold", size=8), nrow=2, rel_heights=c(0.15,1))#
examples2
lam.dens <- plot_grid(NULL, ggplot(boot)+#
geom_segment(data=arrows2, aes(x=-Inf, xend=Inf, y=yaxis*1.2, yend=yaxis*1.2), col="white")+#
geom_segment(data=arrows2, aes(y=yaxis, yend=yaxis, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
geom_text(data=lab.point, aes(x,y, label=lab), size=1.8, hjust=0, nudge_y=0.3)+#
geom_density(aes(x=log(lam), col=spp, fill=spp), alpha=0.5)+#
geom_vline(xintercept=0, linetype="dotted")+#
geom_point(data=params, aes(log.lam3, yaxis,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(log.lam3, yaxis, col=spp), size=3, alpha=0.5)+#
geom_text(data=params[!params$spp=="Ana",], aes(log.lam3, yaxis, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(log.lam3, yaxis, label="D"), size=1.8, fontface="bold")+#
#geom_hline(yintercept=0, size=1, col="white")+#
geom_hline(yintercept=-0.1, size=1, col="black")+#
#scale_y_sqrt(expand=c(0,0))+#
scale_y_continuous(expand=c(0,0))+#
#lims(x=c(min(boot$lam), max(boot$lam)))+#
ggtitle(expression(bold(Fitness)))+#
xlim(c(min(log(boot$lam)), max(log(boot$lam))-0.02))+#
coord_cartesian(xlim=c(-0.5, max(log(boot$lam))))+#
#scale_x_log10(limits=c(min(boot$lam), max(boot$lam)))+#
facet_wrap(~morphology, ncol=1, scales="free_y", strip.position="left")+#
labs(y="Density", x=expression(log(lambda)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
theme_classic()+theme(strip.text=element_blank(), strip.background=element_blank(), axis.text.y=element_blank(), axis.title.y=element_blank(), axis.line.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_text(size=8), axis.title.x=element_text(size=9),plot.title=element_text(size=8, hjust=0.5, face="bold")), nrow=1, rel_widths=c(0.1,1))#
lam.dens#
#
plot_grid(examples1, lam.dens, nrow=1, rel_widths=c(0.5, 1))#
#
r.long$label <-ifelse(r.long$variable=="rec.tran", "Transects","Constant")#
#r.long$label <- factor(r.long$label, levels=c("Fitted","Constant"))#
params$genus <- ifelse(params$family=="Acroporidae", "Acr","Gon")#
#
params$AB <- ifelse(params$abundance_pair=="Rare","R","C")#
#
arrows <- dcast(params[!params$spp=="Ana", ], morphology~abundance_pair,  value.var="rec.one")#
arrows$Common2 <- 10^(log10(arrows$Common)+0.2)#
arrows$Rare2 <- arrows$Rare#
arrows[arrows$morphology %in% c("staghorn", "tabular"),c("Rare2","Common2")] <- arrows[arrows$morphology %in% c("staghorn", "tabular"),c("Rare","Common")]#
#
arrows$diff <-   arrows$Rare/arrows$Common#
storeDET2 <- storeDET[storeDET$rec>1*10^-5 & storeDET$rec<2*10^-1,]#
#
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.2, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange #
#
arrows$Common2[arrows$morphology=="tabular"] <- 9*10^-05#
arrows$Common2[arrows$morphology=="staghorn"] <- 5.5*10^-04 #
#
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete(expand=c(0.3,0.3))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot#
#
GTplot<- ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=log(lam.sd1), yend=log(lam.sd2), col=spp), size=0.5)+#
geom_segment(data=params, aes(x=GT.sd1, xend=GT.sd2, y=log(lam.mn), yend=log(lam.mn), col=spp), size=0.5)+#
geom_point(data=params, aes(GT, log(lam.mn),col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_text(data=params[params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
geom_point(data=params, aes(GT, log(lam.mn), col=spp), size=3, alpha=0.5)+#
#geom_point(shape=21, aes(col=spp), alpha=0.2)+#
#coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+#
scale_fill_manual(values=cols)+#
scale_x_log10()+#
geom_text(data=params[!params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
guides(col="none", fill="none")+#
theme_classic()+#
ggtitle("Generation times")+#
labs(x="Generation Time (years)", y=expression(log(lambda)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"), axis.title=element_text(size=9), axis.text=element_text(size=8))#
GTplot#
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.4,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
storeDET2 <- storeDET[storeDET$rec>1*10^-5 & storeDET$rec<2*10^-1,]#
#
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.54, yend=-0.5), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.54, yend=-0.5), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.52, yend=-0.5), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.52, yend=-0.5), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.52, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.52, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.45), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.45), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.42), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.42), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.44), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.44), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.4,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=14, height=12, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey90")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey90")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.445), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.445), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.445), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.445), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.4,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=14, height=12, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.45), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.45), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange #
#
arrows$Common2[arrows$morphology=="tabular"] <- 9*10^-05#
arrows$Common2[arrows$morphology=="staghorn"] <- 5.5*10^-04 #
#
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete(expand=c(0.3,0.3))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot#
#
GTplot<- ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=log(lam.sd1), yend=log(lam.sd2), col=spp), size=0.5)+#
geom_segment(data=params, aes(x=GT.sd1, xend=GT.sd2, y=log(lam.mn), yend=log(lam.mn), col=spp), size=0.5)+#
geom_point(data=params, aes(GT, log(lam.mn),col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_text(data=params[params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
geom_point(data=params, aes(GT, log(lam.mn), col=spp), size=3, alpha=0.5)+#
#geom_point(shape=21, aes(col=spp), alpha=0.2)+#
#coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+#
scale_fill_manual(values=cols)+#
scale_x_log10()+#
geom_text(data=params[!params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
guides(col="none", fill="none")+#
theme_classic()+#
ggtitle("Generation times")+#
labs(x="Generation Time (years)", y=expression(log(lambda)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"), axis.title=element_text(size=9), axis.text=element_text(size=8))#
GTplot#
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.4,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=14, height=12, units="cm", dpi = 300)
ggsave("figs/fig.2.jpg", fig.2, width=14, height=12.5, units="cm", dpi = 300)
ggsave("figs/fig.2.jpg", fig.2, width=14, height=12, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey90", size=2.5)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange #
#
arrows$Common2[arrows$morphology=="tabular"] <- 9*10^-05#
arrows$Common2[arrows$morphology=="staghorn"] <- 5.5*10^-04 #
#
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete(expand=c(0.3,0.3))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot#
#
GTplot<- ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=log(lam.sd1), yend=log(lam.sd2), col=spp), size=0.5)+#
geom_segment(data=params, aes(x=GT.sd1, xend=GT.sd2, y=log(lam.mn), yend=log(lam.mn), col=spp), size=0.5)+#
geom_point(data=params, aes(GT, log(lam.mn),col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_text(data=params[params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
geom_point(data=params, aes(GT, log(lam.mn), col=spp), size=3, alpha=0.5)+#
#geom_point(shape=21, aes(col=spp), alpha=0.2)+#
#coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+#
scale_fill_manual(values=cols)+#
scale_x_log10()+#
geom_text(data=params[!params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
guides(col="none", fill="none")+#
theme_classic()+#
ggtitle("Generation times")+#
labs(x="Generation Time (years)", y=expression(log(lambda)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"), axis.title=element_text(size=9), axis.text=element_text(size=8))#
GTplot#
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.4,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=14, height=12, units="cm", dpi = 300)
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=14, height=12, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
2e-4
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=2e-4, xmax=5e-3, ymin=-0.45, ymax=-0.55))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=5e-4, xmax=5e-3, ymin=-0.55, ymax=-0.5))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=3e-4, xmax=5e-3, ymin=-0.6, ymax=-0.5))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=4e-4, xmax=3e-3, ymin=-0.6, ymax=-0.5))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=4e-4, xmax=3e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=14, height=12, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_rect(data=NULL, aes(xmin=4e-4, xmax=3e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=4e-4, xmax=3e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
arrows$Common2[arrows$morphology=="tabular"] <- 9*10^-05#
arrows$Common2[arrows$morphology=="staghorn"] <- 5.5*10^-04 #
#
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete(expand=c(0.3,0.3))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot#
#
GTplot<- ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=log(lam.sd1), yend=log(lam.sd2), col=spp), size=0.5)+#
geom_segment(data=params, aes(x=GT.sd1, xend=GT.sd2, y=log(lam.mn), yend=log(lam.mn), col=spp), size=0.5)+#
geom_point(data=params, aes(GT, log(lam.mn),col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_text(data=params[params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
geom_point(data=params, aes(GT, log(lam.mn), col=spp), size=3, alpha=0.5)+#
#geom_point(shape=21, aes(col=spp), alpha=0.2)+#
#coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+#
scale_fill_manual(values=cols)+#
scale_x_log10()+#
geom_text(data=params[!params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
guides(col="none", fill="none")+#
theme_classic()+#
ggtitle("Generation times")+#
labs(x="Generation Time (years)", y=expression(log(lambda)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"), axis.title=element_text(size=9), axis.text=element_text(size=8))#
GTplot#
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=14, height=12, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=4e-4, xmax=3e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2)+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2)+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
ggsave("figs/fig.2.jpg", fig.2, width=15, height=12.5, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=4e-4, xmax=3e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.48), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.435), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.435), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=4e-4, xmax=3e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.5, size=2)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
storeDET2 <- storeDET[storeDET$rec>1*10^-5 & storeDET$rec<2*10^-1,]#
#
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=4e-4, xmax=3e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.6, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=4e-4, xmax=3e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=3e-4, xmax=2e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=3.5e-4, xmax=2.5e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=15, height=12.5, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=3.5e-4, xmax=2.5e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ), col="grey85")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=3.5e-4, xmax=2.5e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.47), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_rect(data=NULL, aes(xmin=3.5e-4, xmax=2.5e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.475), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.475), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_rect(data=NULL, aes(xmin=3.5e-4, xmax=2.5e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.475), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.475), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
?geom_lavel
?geom_label
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_rect(data=NULL, aes(xmin=3.5e-4, xmax=2.5e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.475), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.475), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey", label.padding=0)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_rect(data=NULL, aes(xmin=3.5e-4, xmax=2.5e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.475), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.475), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey", label.size=0)+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.78), label=expression(italic(P[rec])), size=2.5)+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.77), label="Acr", size=2)+#
#geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.17), label="Gon", size=2)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=0.72, yend=0.65), arrow=arrow(length=unit(1, "mm") ))+#
#geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=0.12, yend=0.05), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_rect(data=NULL, aes(xmin=3.5e-4, xmax=2.5e-3, ymin=-0.6, ymax=-0.5), fill="white", col=NA)+#
geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey", label.size=0)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.475), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.5, yend=-0.475), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=params, aes(x=rec.mean, y=log(lam.est2), label=AB), size=1.5, fontface="bold")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
#ggtitle("Recruitment vs fitness")+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
#coord_cartesian(ylim=c(0.6,2))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=15, height=12.5, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey", label.size=0)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.49, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.49, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=15, height=12.5, units="cm", dpi = 300)
ggsave("figs/fig.2.jpg", fig.2, width=15, height=12.7, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=min(params$rec.tran), xend=min(params$rec.tran)), col="grey85")+#
geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey", label.size=0)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.49, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.49, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=min(params$rec.tran), xend=min(params$rec.tran)), col="grey85")+#
geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=max(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey", label.size=0)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.49, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.49, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=15, height=12.7, units="cm", dpi = 300)
max(params$rec.tran)
min(params$rec.tran)
vara
var
########################################
# COMPARE LAMS#
########################################
#
params2$lam.est <- params$lam.est[match(params2$spp, params$spp)]#
#
morph.diff <- function(x){#
	#x <-"m.int"#
	params2$x.temp <-params[match(params2$spp, params$spp), x]#
	comp$x.common <- params2$x.temp[match(comp$Common, params2$spp)]#
	comp$x.rare <- params2$x.temp[match(comp$Rare, params2$spp)]#
	comp$x.diff <- comp$x.common-comp$x.rare#
	comp$x.div <- comp$x.common/comp$x.rare#
	comp#
	}#
#
comp$AC<-morph.diff("abundance_05")$x.common#
comp$AR<-morph.diff("abundance_05")$x.rare#
comp$abundiff <- morph.diff("abundance_05")$x.div#
#
comp$lamC <- morph.diff("lam.est")$x.common#
comp$lamR <- morph.diff("lam.est")$x.rare#
comp$lamdiff <- morph.diff("lam.est")$x.diff#
comp$logdiff <- log(comp$lamC) - log(comp$lamR)#
#
# Double recruitment#
doub_lam <- NULL#
for(sp in spp){#
	rec <- params$rec[params$spp==sp] * 2#
	rec.size <- params$rec.size[params$spp==sp]#
	h <- mesh()$h#
	y <- mesh()$y#
	doub_lam <- rbind(doub_lam, data.frame(spp=sp, lam=bigmatrix()$lam))#
	}#
comp$doubC <- doub_lam$lam[match(comp$Common, doub_lam$spp)]#
comp$doubR <- doub_lam$lam[match(comp$Rare, doub_lam$spp)]#
comp$doubdiff <- comp$doubC - comp$doubR#
#
ggplot(comp)+#
geom_bar(aes(y=reorder(morph, -lamdiff), x=lamdiff), stat="identity")+#
geom_segment(aes(y=reorder(morph, -lamdiff), yend=reorder(morph, -lamdiff), x=lamdiff, xend=doubdiff), arrow=arrow(length=unit(1,"mm")))#
#
########################################
# TIME NEEDED TO GET DIFFERENCES#
########################################
#
# method 1 #
#
comp$doub.time <- log(2)/log(1+comp$lamdiff)#
comp$difftime <- log(comp$abundiff)/log(1+comp$lamdiff)#
ggplot(comp[comp$difftime>0,], aes(x=difftime, y=reorder(morph, -difftime)))+#
geom_bar(stat="Identity", aes(fill=morph))+#
labs(x="Years to project \nabundance differences")+#
guides(fill="none")+scale_fill_manual(values=colsC)#
#
# method 2 - projecting lamda#
#
n1 <- 100#
ngen <- 100#
pars <- params2[, c("spp","morph", "abundance_pair","lam.est")]#
proj <- merge(pars, data.frame(gen=1:ngen))#
proj$n <- n1*proj$lam.est^proj$gen#
#
ggplot(proj, aes(gen, n))+geom_line(aes(group=spp, col=spp))+scale_colour_manual(values=cols)+facet_wrap(~morph, scales="free_y")#
#
ssq <- NULL#
for(i in seq(1, 50, 1)){#
Gen5 <- subset(proj, gen==i )#
params2$Gen5<-scale(Gen5$n[match(params2$spp, Gen5$spp)])#
mod <- aov(Gen5~morphology, data=params2)#
summary(mod)#
within <- summary(mod)[[1]]["Residuals","Sum Sq"]#
between <- summary(mod)[[1]]["morphology","Sum Sq"]#
ssq <- rbind(ssq, data.frame(i, within1=within, between=between, within2=(within/(within+between))))#
}#
#
plot_grid(ggplot()+geom_point(data=ssq, aes(i, within1))+geom_point(data=ssq, aes(i, between), col="red")+scale_y_log10(),#
ggplot(ssq, aes(i, within2))+geom_point() )#
#
proj2 <- dcast(morph+gen~abundance_pair, data=proj, value.var="n")#
proj2$diff <- proj2$Common/proj2$Rare#
proj2$real <- comp$abundiff[match(proj2$morph, comp$morph)]#
gens <- aggregate(gen~morph, proj2[proj2$diff<proj2$real,], max)#
proj2$maxgen <- gens$gen[match(proj2$morph, gens$morph)] +1 #to cross the line#
head(proj2)#
#
ggplot(proj2, aes(gen, diff, col=morph))+geom_line(linetype="dotted")+coord_cartesian(ylim=c(0,300))+geom_line(data=proj2[proj2$gen<=proj2$maxgen,])+geom_point(data=proj2[proj2$gen==proj2$maxgen,])#
# method 3 - projecting lamda from size dist.. #
#
proj.size <- NULL#
for(sp in spp){#
	#sp <-"Ahu"#
	rec <- params$rec[params$spp==sp] #
	rec.size <- params$rec.size[params$spp==sp]#
	h <- mesh()$h#
	y <- mesh()$y#
	lam=bigmatrix()$lam#
	v=bigmatrix()$v#
	w=bigmatrix()$w#
	ngen <- 200#
	npop <- 100#
	v <- matrix(c(1, rep(0,99)))#
pop  <- matrix(nrow=npop, ncol=ngen) # size classes by gens.#
pop[,1] <- round(v * npop) # inital population size#
#plot(y, pop[,1])#
#for(j in 2:ngen){ pop[,j] <- pop[,j-1]*lam }#
for(j in 2:ngen){ pop[,j] <- bigmatrix()$K %*% as.matrix(pop[,j-1]) }#
pop.long <- melt(pop, value.name = "NperSize")#
colnames(pop.long)[1]<-"Size"#
colnames(pop.long)[2]<-"gen"#
head(pop.long)#
ggplot(data=pop.long[pop.long$gen %in% c(1,5,10,20),], aes(x=Size, y=NperSize,  group=Size))+geom_point(shape=21)+facet_wrap(~gen, scales="free_y")#
psize<-	aggregate(NperSize~gen, data=pop.long, sum)#
psize$n <- npop*lam^psize$gen # compare with simple method...#
proj.size <- rbind(proj.size, cbind(psize, spp=sp, abun=params$abundance_pair[params$spp==sp], morph=params$morph[params$spp==sp]))#
}#
#
head(proj.size)#
	ggplot()+#
	geom_point(data=proj.size, aes(gen, NperSize, col=spp))+#
	scale_y_log10()+scale_colour_manual(values=cols)+#
	facet_wrap(~morph)#
ssq <- NULL#
for(i in seq(2, 50, 1)){#
Gen5 <- subset(proj.size, gen==i )#
params$Gen5<-scale(Gen5$NperSize[match(params$spp, Gen5$spp)])#
mod <- aov(Gen5~morphology, data=params)#
summary(mod)#
within <- summary(mod)[[1]]["Residuals","Sum Sq"]#
between <- summary(mod)[[1]]["morphology","Sum Sq"]#
ssq <- rbind(ssq, data.frame(i, within1=within, between=between, within2=(within/(within+between))))#
}#
#
plot_grid(ggplot()+geom_point(data=ssq, aes(i, within1))+geom_point(data=ssq, aes(i, between), col="red")+scale_y_log10(),#
ggplot(ssq, aes(i, within2))+geom_point() )#
	hist(proj3$diff)#
#
proj.size2 <- proj.size[!proj.size$spp=="Ana",]	#
#proj.size$morph <- ifelse(proj.size$spp=="Ana", "corymbose_2",as.character(proj.size$morph))#
#cory2 <- proj.size[proj.size$spp=="Ami",]#
#cory2$morph <- "corymbose_2"#
#proj.size2 <- rbind(proj.size, cory2)#
#
proj3 <- dcast(morph+gen~abun, data=proj.size2, value.var="NperSize")#
proj3$diff <- proj3$Common/proj3$Rare#
proj3$real <- comp$abundiff[match(proj3$morph, comp$morph)]#
gens <- aggregate(gen~morph, proj3[proj3$diff<proj3$real,], max)#
proj3$maxgen <- gens$gen[match(proj3$morph, gens$morph)] +1 #
head(proj3)	#
gens #
tail(proj3)#
#
aggregate(diff~morph, proj3, min)#
#
projdat <- proj3[proj3$gen==proj3$maxgen,]#
projdat#
ggplot(proj3, aes(gen, diff, col=morph))+#
geom_line(linetype="dotted")+#
geom_line(data=proj3[proj3$gen<=proj3$maxgen,])+#
geom_point(data=proj3[proj3$gen==proj3$maxgen,])+ #
#scale_y_log10()+#scale_x_log10()+#
scale_y_sqrt()+scale_x_sqrt()+#
coord_cartesian(ylim=c(0,60), xlim=c(0,100))#
#
########################################
# WITHIN VS BETWEEN#
########################################
#
Gen5 <- subset(proj.size, gen==5 )#
params$Gen5<-Gen5$NperSize[match(params$spp, Gen5$spp)]#
#
Gen10 <- subset(proj.size, gen==10)#
params$Gen10<-Gen10$NperSize[match(params$spp, Gen10$spp)]#
#
dems <- c("lam.est", "Gen5",  "Gen10", "abundance_05", "rec")#
#
vars <- NULL#
for (t in c(traits, "eggC",dems)){#
	#t <- "Gen15"#
	params$t <- scale(params[,t])#
mod <- aov(t~morphology, data=params)#
summary(mod)#
within <- summary(mod)[[1]]["Residuals","Sum Sq"]#
between <- summary(mod)[[1]]["morphology","Sum Sq"]#
pval <- summary(mod)[[1]]["morphology","Pr(>F)"]#
summary(mod)#
vars <- rbind(vars, data.frame(t, within=100*(within/(within+between)), between=100*(between/(within+between)), pval))#
}#
ggplot(vars, aes(within,reorder(t, -within)))+geom_bar(stat="identity")
vars
params
########################################
# IPM MESH AND BOUNDARIES#
########################################
#
# repeat function to generate mesh for each species#
max.size <- 0.3 # max(ss$area)#
n <- 100#
mesh <- function(){#
	min.size <- rec.size # 3.5#
	b <- seq(min.size, max.size, length=n)#
	h <- b[2] - b[1]#
	b <- c(min(b)-(2*h), min(b)-h, b)#
	y <- 0.5 * (b[1:n]+b[2:(n+1)])#
	I <- y >= rec.size#
	return(list(b=b,h=h,y=y,I=I, rec.size = rec.size))}#
########################################
# RECRUITMENT PARAMETERS#
########################################
#
# recruit size - based on max growth, mean within groups#
agg <- aggregate(r.int~morphology, params, mean)#
params$r.int2 <- agg$r.int[match(params$morphology, agg$morphology)]#
params$rec.size <- log10(pi*(params$r.int2*0.85)^2)#
#r.limit <- 12#
#params$rec.size <- ifelse(params$rec.size>log10(pi*((r.limit/2)/100)^2),log10(pi*((r.limit/2)/100)^2), params$rec.size)#
# alternatively: *0.8 recsize without limit.#
#
# recruitment probability - same within families#
params$rec <- ifelse(params$family=="Merulinidae",0.0003162278, 0.0011364637)#
#
########################################
# PLOT IPMS#
########################################
#
# source("figs/supp/supp.fig3.R")#
# fig.s3#
# ggsave("figs/supp.fig3.jpg", fig.s3, width=20, height=10.2, units="cm")#
#
########################################
# ESTIMATE LAM#
########################################
#
lam.est <- NULL#
for (sp in spp) {#
rec.size <- params$rec.size[params$spp==sp]#
rec <- params$rec[params$spp==sp]#
h <- mesh()$h#
y <- mesh()$y#
lam.est<-rbind(lam.est, data.frame(sp, lam=bigmatrix()$lam))#
}#
params$lam.est <- lam.est$lam#
#
ggplot(params, aes(reorder(spp, -lam.est), lam.est))+geom_bar(stat="identity", aes(fill=spp))+scale_fill_manual(values=cols)+geom_hline(yintercept=1)#
#
params[,c("spp","lam.est", "g.slp")]#
#
########################################
# CHANGE IN ABUNDANCE (TRANSECTS)#
########################################
#
head(abun)#
diffs <- data.frame(dcast(abun, species+tran~year, value.var="N"))#
diffs$diff <- (diffs$X2014-diffs$X2011)#
diffs$spp<-params$spp[match(diffs$species, params$species)]#
diffs$lam <- params$lam.est[match(diffs$spp, params$spp)]#
#
ggplot(diffs, aes(reorder(spp, -lam), diff, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
scale_fill_manual(values=cols)+guides(fill="none")#
#
d.mean<-aggregate(X2011~species, diffs, mean)#
d.mean$X2014 <- aggregate(X2014~species, diffs, mean)$X2014#
d.mean$X2014 <- ifelse(d.mean$X2014==0, 0.05, d.mean$X2014)#
d.mean$X2011 <- ifelse(d.mean$X2011==0, 0.05, d.mean$X2011)#
# give absent species a small abundance (0.1)^^#
d.mean$lam.tran <- (d.mean$X2014/d.mean$X2011)^(1/3)#
d.mean#
#
params$lam.tran <- d.mean$lam.tran[match(params$species, d.mean$species)]#
#
ggplot(params, aes(lam.est, lam.tran))+geom_text(aes(label=spp))+geom_abline(slope=1)+geom_smooth(method="lm", se=F, linetype="dotted")+scale_y_log10()+scale_x_log10()#
#
summary(lm(log(lam.tran)~log(lam.est), params))#
#
# source("figs/supp.fig4.R")#
# fig.s4#
# ggsave("figs/supp.fig4.jpg", fig.s4, width=15, height=10.2, units="cm")#
########################################
# RECRUITMENT SENSITIVITY I#
#######################################	#
rec.xDET <- 10^(seq(-5,-1, 0.1))#
#
storeDET<-data.frame()#
for (sp in spp) {#
	for (rec in rec.xDET){#
	  rec.size <- params$rec.size[params$spp==sp]#
	  h <- mesh()$h#
	  y <- mesh()$y#
  sub<-dat[dat$spp==sp,]#
   mod <- bigmatrix()#
  storeDET<-rbind(storeDET, data.frame(spp=sp, rec=rec, lam=bigmatrix()$lam))#
   } #
  }#
#
ggplot(storeDET, aes(rec, lam))+geom_line(aes(col=spp))+scale_x_log10()+scale_colour_manual(values=cols)+coord_cartesian(ylim=c(0.6,2))+guides(col="none")#
#
########################################
# REC AT TRANSECT LAMS#
#######################################	#
#
rec.transect <- NULL#
for(sp in spp){#
	#sp <- "Gre"#
sub <- storeDET[storeDET$spp==sp,]#
r.sp <- params$lam.tran[params$spp==sp]#
n.rec <- which(abs(sub$lam-r.sp)==min(abs(sub$lam-r.sp)))#
if(n.rec==1){#
newlam<-	min(sub$lam)+0.01#
n.rec2 <- which(abs(sub$lam-newlam)==min(abs(sub$lam-newlam)))#
new <- sub[n.rec2,]#
} else { new <- sub[n.rec,] }#
rec.transect <- rbind(rec.transect, cbind(new, lam.r=r.sp))#
}#
#
rec.transect#
#
params$rec.tran <- rec.transect$rec[match(params$spp, rec.transect$spp)]#
#
# rec at 1... #
rec.one <- NULL#
for(sp in spp){#
sub <- storeDET[storeDET$spp==sp,]#
n.rec <- which(abs(sub$lam-1)==min(abs(sub$lam-1)))#
rec.one <- rbind(rec.one, cbind(sub[n.rec,], lam.r=r.sp))#
}#
rec.one#
params$rec.one <- rec.one$rec[match(params$spp, rec.one$spp)]#
#
########################################
# REC AT TRANSECT LAMS#
#######################################	#
#
agg.rec <- aggregate(log10(rec.tran)~family, params, mean)#
params$rec.mean <- 10^agg.rec[match(params$family, agg.rec$family),"log10(rec.tran)"]#
#params$rec.mean <- 10^mean(log10(params$rec.tran))#
#params$rec.mean <- median(params$rec.tran)#
#
r.long <- melt(params[c("spp","rec.mean", "rec.tran")])#
r.long#
#
#r.long<-r.long[!(r.long$spp=="Gpe" & r.long$variable=="rec.tran"),] #
plot_grid(#
ggplot(r.long, aes(variable, value))+#
geom_path(aes(group=spp), size=0.1)+#
#geom_jitter(aes(col=spp), height=0.05, width=0.05)+#
geom_point(aes(col=spp))+#
geom_point(data=params, aes(x="rec.mean",rec.mean))+#
geom_text(data=params[params$spp %in% c("Gre","Ahy"),], aes(x="rec.mean",rec.mean, label=family), nudge_y=0.1, nudge_x=0.2, angle=15, hjust=0, size=2)+#
scale_y_log10(limits=c(min(storeDET$rec),max(storeDET$rec)))+#
scale_colour_manual(values=cols)+#
#geom_path(aes(col=spp, group=spp))+#
coord_flip()+#
guides(col="none"), #
ggplot(storeDET, aes(rec, lam))+geom_line(aes(col=spp))+scale_x_log10(limits=c(min(storeDET$rec),max(storeDET$rec)))+#
geom_hline(yintercept=1)+#
#guides(col="none")+#
scale_colour_manual(values=cols)+coord_cartesian(ylim=c(0.6,2)),#
ncol=1, rel_heights=c(0.5,1), align="v", axis="lr")#
#
########################################
# ESTIMATE LAM#
########################################
#
lam.est <- NULL#
for (sp in spp) {#
rec.size <- params$rec.size[params$spp==sp]#
rec <- params$rec.mean[params$spp==sp]#
h <- mesh()$h#
y <- mesh()$y#
lam.est<-rbind(lam.est, data.frame(sp, lam=bigmatrix()$lam))#
}#
params$lam.est2 <- lam.est$lam#
#
#ggplot()#
#
ggplot(params, aes(reorder(spp, -lam.est2), lam.est2))+geom_bar(stat="identity", aes(fill=spp))+scale_fill_manual(values=cols)+geom_hline(yintercept=1)#
#
params[,c("spp","lam.est","lam.est2", "g.slp")]#
#
params$lam.est <- params$lam.est2#
  ######### NEW REC!!!!#
params$rec <- params$rec.mean#
#
########################################
# BOOTSTRAP#
#######################################	#
gdat_orig <- gdat#
sdat_orig <-sdat#
fec_orig <-fec#
#
#source("R/bootstap_lam.R")#
boot <- read.csv("data/lam.range.csv")#
#
ggplot(boot)+#
geom_density(aes(x=log(lam), col=spp, fill=spp), alpha=0.5)+#
geom_vline(xintercept=0, linetype="dotted")+#
#geom_point(data=params, aes(lam.est, y=0), col="grey")+#
#geom_point(data=params, aes(x=lam.est2, y=0))+#
facet_wrap(~morphology, scale="free_y", ncol=1)+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#xlim(c(0.5, 1.8))+#
#scale_x_log10(limits=c(0.5, 2))+#
theme_classic()#
#
head(boot)#
boot$GT <- log(boot$r)/log(boot$lam)#
ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0)+#
geom_point(shape=21, aes(col=spp), alpha=0.2)+#
coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+scale_x_log10()+#
geom_point(data=params, aes(GT, log(lam.est)))+guides(col="none")+#
theme_classic()#
########################################
# ELASTICITY & IPM MEASURES #
########################################
 # eigen-things combined to get sensitivity/elasticity matrices.#
#
s.list <- list()#
eK.list <- list()#
eR.list <- list()#
eP.list <- list()#
demovals <- NULL#
sizevals <- NULL#
#
for (sp in spp) {#
	#sp <- "Ahy"#
	rec <- params$rec[params$spp==sp]#
	rec.size <- params$rec.size[params$spp==sp]#
	h <- mesh()$h#
	y <- mesh()$y#
	K <- bigmatrix()$K#
	P <- bigmatrix()$P#
	R <- bigmatrix()$R#
	#image(t(K^0.2))#
	lam <- Re(eigen(K)$values[1]) # population growth#
	w.eigen<-Re(eigen(K)$vectors[,1]) # right eigenvec#
	stable.size <- w.eigen/sum(w.eigen) # sable size dist #
	v.eigen<-Re(eigen(t(K))$vectors[,1]) # left eigenvec#
	repro.val <- v.eigen/v.eigen[1] # rel. reprodutive values #
	v.dot.w<-sum(stable.size*repro.val*h) # reproductive val * stable size#
	sens<-outer(repro.val,stable.size,"*")/v.dot.w   # sensitivity matrix#
	K.elas <- sens*(K/h)/lam *h^2 # elasticity matrices (h varies)#
	P.elas<-(P/h)*sens/lam # survival elasticity matrix#
	eP=sum(P.elas)*h^2 # total survival elasticity#
	R.elas<-(R/h)*sens/lam # reproduction elasticity matrix#
	eR=sum(R.elas)*h^2 # total reproduction elasticity#
	# Net reproductive rate/Generation time from IPMbook monocarp#
	N <- solve(diag(n)-P)#
	R0 <- abs(eigen(R %*% N)$values[1])#
	GT <- log(R0)/log(lam)#
	demovals <- rbind(demovals, data.frame(spp=sp, eR, eP, R0, GT))#
	sizevals <- rbind(sizevals, data.frame(spp=sp, area=y, stable.size, repro.val, v.dot.w))#
		s.list[[sp]] <- sens#
		eR.list[[sp]] <- R.elas#
		eP.list[[sp]] <- P.elas#
		eK.list[[sp]] <- K.elas#
		}#
#
params[,colnames(demovals)]<- demovals[match(demovals$spp, params$spp),]#
lapply(eK.list, function(x){sum(x)})#
rowSums(demovals[,c("eP","eR")]) # summing to 1#
#
plot_grid(#
ggplot(sizevals, aes(x=area, y=repro.val, col=spp))+geom_line()+#
scale_colour_manual(values=cols)+#
scale_y_log10()+guides(col="none"),#
ggplot(sizevals, aes(x=area, y=stable.size, col=spp))+geom_line()+#
scale_colour_manual(values=cols)+guides(col="none"),#
ggplot(params, aes(reorder(spp, -eR), eR, fill=spp))+geom_bar(stat="identity")+scale_fill_manual(values=cols)+guides(fill="none"), #
ggplot(params, aes(reorder(spp, -R0), R0, fill=spp))+geom_bar(stat="identity")+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_log10(),#
ggplot(params, aes(reorder(spp, -GT), GT, fill=spp))+geom_bar(stat="identity")+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_log10(),#
ggplot(params, aes(r.int, eR))+geom_text(aes(label=spp))+scale_y_sqrt()+scale_x_log10())#
#
########################################
#GENERATION TIME#
#######################################	#
#
sds<-aggregate(lam~spp, boot, function(x){ quantile(x, 0.95) })#
params$lam.sd1 <- (sds$lam[match(params$spp, sds$spp)])#
sds<-aggregate(lam~spp, boot, function(x){ quantile(x, 0.05) })#
params$lam.sd2 <- (sds$lam[match(params$spp, sds$spp)])#
sds<-aggregate(lam~spp, boot, median)#
params$lam.mn <- (sds$lam[match(params$spp, sds$spp)])#
#
sds<-aggregate(GT~spp, boot, function(x){ quantile(x, 0.95) })#
params$GT.sd1 <- (sds$GT[match(params$spp, sds$spp)])#
sds<-aggregate(GT~spp, boot, function(x){ quantile(x, 0.05) })#
params$GT.sd2 <- (sds$GT[match(params$spp, sds$spp)])#
sds<-aggregate(GT~spp, boot, median)#
params$GT.mn <- (sds$GT[match(params$spp, sds$spp)])#
#
ggplot()+geom_hline(yintercept=1, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=lam.sd1, yend=lam.sd2), size=0.2)+#
geom_point(data=params,aes(GT, lam.mn, fill=spp), shape=21, stroke=0.2, size=3)+#
geom_text(data=params, aes(GT, lam.mn, label=AB), size=1.8)+#
#scale_x_log10()+#scale_y_log10()+#
scale_fill_manual(values=cols)+guides(fill="none")+#
theme_classic()#
#
########################################
# FIG 2#
#######################################	#
source("figs/fig.2.R") # check ordering#
fig.2#
#ggsave("figs/fig.2.jpg", fig.2, width=15, height=12.7, units="cm", dpi = 300)
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=min(params$rec.tran), xend=min(params$rec.tran)), col="grey85")+#
#geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=max(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey", label.size=0)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.49, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.49, yend=-0.48), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.43), label="Acr", size=2, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.43), label="Gon", size=2,col="grey")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=min(params$rec.tran), xend=min(params$rec.tran)), col="grey85")+#
#geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=max(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey", label.size=0)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.52, yend=-0.51), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.52, yend=-0.51), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.46), label="Acr", size=2.5, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.46), label="Gon", size=2.5,col="grey")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=15, height=12.7, units="cm", dpi = 300)
########################################
# COMPARE LAMS#
########################################
#
params2$lam.est <- params$lam.est[match(params2$spp, params$spp)]#
#
morph.diff <- function(x){#
	#x <-"m.int"#
	params2$x.temp <-params[match(params2$spp, params$spp), x]#
	comp$x.common <- params2$x.temp[match(comp$Common, params2$spp)]#
	comp$x.rare <- params2$x.temp[match(comp$Rare, params2$spp)]#
	comp$x.diff <- comp$x.common-comp$x.rare#
	comp$x.div <- comp$x.common/comp$x.rare#
	comp#
	}#
#
comp$AC<-morph.diff("abundance_05")$x.common#
comp$AR<-morph.diff("abundance_05")$x.rare#
comp$abundiff <- morph.diff("abundance_05")$x.div#
#
comp$lamC <- morph.diff("lam.est")$x.common#
comp$lamR <- morph.diff("lam.est")$x.rare#
comp$lamdiff <- morph.diff("lam.est")$x.diff#
comp$logdiff <- log(comp$lamC) - log(comp$lamR)#
#
# Double recruitment#
doub_lam <- NULL#
for(sp in spp){#
	rec <- params$rec[params$spp==sp] * 2#
	rec.size <- params$rec.size[params$spp==sp]#
	h <- mesh()$h#
	y <- mesh()$y#
	doub_lam <- rbind(doub_lam, data.frame(spp=sp, lam=bigmatrix()$lam))#
	}#
comp$doubC <- doub_lam$lam[match(comp$Common, doub_lam$spp)]#
comp$doubR <- doub_lam$lam[match(comp$Rare, doub_lam$spp)]#
comp$doubdiff <- comp$doubC - comp$doubR#
#
ggplot(comp)+#
geom_bar(aes(y=reorder(morph, -lamdiff), x=lamdiff), stat="identity")+#
geom_segment(aes(y=reorder(morph, -lamdiff), yend=reorder(morph, -lamdiff), x=lamdiff, xend=doubdiff), arrow=arrow(length=unit(1,"mm")))#
#
########################################
# TIME NEEDED TO GET DIFFERENCES#
########################################
#
# method 1 #
#
comp$doub.time <- log(2)/log(1+comp$lamdiff)#
comp$difftime <- log(comp$abundiff)/log(1+comp$lamdiff)#
ggplot(comp[comp$difftime>0,], aes(x=difftime, y=reorder(morph, -difftime)))+#
geom_bar(stat="Identity", aes(fill=morph))+#
labs(x="Years to project \nabundance differences")+#
guides(fill="none")+scale_fill_manual(values=colsC)#
#
# method 2 - projecting lamda#
#
n1 <- 100#
ngen <- 100#
pars <- params2[, c("spp","morph", "abundance_pair","lam.est")]#
proj <- merge(pars, data.frame(gen=1:ngen))#
proj$n <- n1*proj$lam.est^proj$gen#
#
ggplot(proj, aes(gen, n))+geom_line(aes(group=spp, col=spp))+scale_colour_manual(values=cols)+facet_wrap(~morph, scales="free_y")#
#
ssq <- NULL#
for(i in seq(1, 50, 1)){#
Gen5 <- subset(proj, gen==i )#
params2$Gen5<-scale(Gen5$n[match(params2$spp, Gen5$spp)])#
mod <- aov(Gen5~morphology, data=params2)#
summary(mod)#
within <- summary(mod)[[1]]["Residuals","Sum Sq"]#
between <- summary(mod)[[1]]["morphology","Sum Sq"]#
ssq <- rbind(ssq, data.frame(i, within1=within, between=between, within2=(within/(within+between))))#
}#
#
plot_grid(ggplot()+geom_point(data=ssq, aes(i, within1))+geom_point(data=ssq, aes(i, between), col="red")+scale_y_log10(),#
ggplot(ssq, aes(i, within2))+geom_point() )#
#
proj2 <- dcast(morph+gen~abundance_pair, data=proj, value.var="n")#
proj2$diff <- proj2$Common/proj2$Rare#
proj2$real <- comp$abundiff[match(proj2$morph, comp$morph)]#
gens <- aggregate(gen~morph, proj2[proj2$diff<proj2$real,], max)#
proj2$maxgen <- gens$gen[match(proj2$morph, gens$morph)] +1 #to cross the line#
head(proj2)#
#
ggplot(proj2, aes(gen, diff, col=morph))+geom_line(linetype="dotted")+coord_cartesian(ylim=c(0,300))+geom_line(data=proj2[proj2$gen<=proj2$maxgen,])+geom_point(data=proj2[proj2$gen==proj2$maxgen,])#
# method 3 - projecting lamda from size dist.. #
#
proj.size <- NULL#
for(sp in spp){#
	#sp <-"Ahu"#
	rec <- params$rec[params$spp==sp] #
	rec.size <- params$rec.size[params$spp==sp]#
	h <- mesh()$h#
	y <- mesh()$y#
	lam=bigmatrix()$lam#
	v=bigmatrix()$v#
	w=bigmatrix()$w#
	ngen <- 200#
	npop <- 100#
	v <- matrix(c(1, rep(0,99)))#
pop  <- matrix(nrow=npop, ncol=ngen) # size classes by gens.#
pop[,1] <- round(v * npop) # inital population size#
#plot(y, pop[,1])#
#for(j in 2:ngen){ pop[,j] <- pop[,j-1]*lam }#
for(j in 2:ngen){ pop[,j] <- bigmatrix()$K %*% as.matrix(pop[,j-1]) }#
pop.long <- melt(pop, value.name = "NperSize")#
colnames(pop.long)[1]<-"Size"#
colnames(pop.long)[2]<-"gen"#
head(pop.long)#
ggplot(data=pop.long[pop.long$gen %in% c(1,5,10,20),], aes(x=Size, y=NperSize,  group=Size))+geom_point(shape=21)+facet_wrap(~gen, scales="free_y")#
psize<-	aggregate(NperSize~gen, data=pop.long, sum)#
psize$n <- npop*lam^psize$gen # compare with simple method...#
proj.size <- rbind(proj.size, cbind(psize, spp=sp, abun=params$abundance_pair[params$spp==sp], morph=params$morph[params$spp==sp]))#
}#
#
head(proj.size)
ggplot()+#
	geom_point(data=proj.size, aes(gen, NperSize, col=spp))+#
	scale_y_log10()+scale_colour_manual(values=cols)+#
	facet_wrap(~morph)#
ssq <- NULL#
for(i in seq(2, 50, 1)){#
Gen5 <- subset(proj.size, gen==i )#
params$Gen5<-scale(Gen5$NperSize[match(params$spp, Gen5$spp)])#
mod <- aov(Gen5~morphology, data=params)#
summary(mod)#
within <- summary(mod)[[1]]["Residuals","Sum Sq"]#
between <- summary(mod)[[1]]["morphology","Sum Sq"]#
ssq <- rbind(ssq, data.frame(i, within1=within, between=between, within2=(within/(within+between))))#
}#
#
plot_grid(ggplot()+geom_point(data=ssq, aes(i, within1))+geom_point(data=ssq, aes(i, between), col="red")+scale_y_log10(),#
ggplot(ssq, aes(i, within2))+geom_point() )#
	hist(proj3$diff)#
#
proj.size2 <- proj.size[!proj.size$spp=="Ana",]	#
#proj.size$morph <- ifelse(proj.size$spp=="Ana", "corymbose_2",as.character(proj.size$morph))#
#cory2 <- proj.size[proj.size$spp=="Ami",]#
#cory2$morph <- "corymbose_2"#
#proj.size2 <- rbind(proj.size, cory2)#
#
proj3 <- dcast(morph+gen~abun, data=proj.size2, value.var="NperSize")#
proj3$diff <- proj3$Common/proj3$Rare#
proj3$real <- comp$abundiff[match(proj3$morph, comp$morph)]#
gens <- aggregate(gen~morph, proj3[proj3$diff<proj3$real,], max)#
proj3$maxgen <- gens$gen[match(proj3$morph, gens$morph)] +1 #
head(proj3)	#
gens #
tail(proj3)#
#
aggregate(diff~morph, proj3, min)#
#
projdat <- proj3[proj3$gen==proj3$maxgen,]#
projdat#
ggplot(proj3, aes(gen, diff, col=morph))+#
geom_line(linetype="dotted")+#
geom_line(data=proj3[proj3$gen<=proj3$maxgen,])+#
geom_point(data=proj3[proj3$gen==proj3$maxgen,])+ #
#scale_y_log10()+#scale_x_log10()+#
scale_y_sqrt()+scale_x_sqrt()+#
coord_cartesian(ylim=c(0,60), xlim=c(0,100))#
#
########################################
# WITHIN VS BETWEEN#
########################################
#
Gen5 <- subset(proj.size, gen==5 )#
params$Gen5<-Gen5$NperSize[match(params$spp, Gen5$spp)]#
#
Gen10 <- subset(proj.size, gen==10)#
params$Gen10<-Gen10$NperSize[match(params$spp, Gen10$spp)]#
#
dems <- c("lam.est", "Gen5",  "Gen10", "abundance_05", "rec")#
#
vars <- NULL#
for (t in c(traits, "eggC",dems)){#
	#t <- "Gen15"#
	params$t <- scale(params[,t])#
mod <- aov(t~morphology, data=params)#
summary(mod)#
within <- summary(mod)[[1]]["Residuals","Sum Sq"]#
between <- summary(mod)[[1]]["morphology","Sum Sq"]#
pval <- summary(mod)[[1]]["morphology","Pr(>F)"]#
summary(mod)#
vars <- rbind(vars, data.frame(t, within=100*(within/(within+between)), between=100*(between/(within+between)), pval))#
}#
ggplot(vars, aes(within,reorder(t, -within)))+geom_bar(stat="identity")#
#
########################################
# SENSITIVITY ANALYSIS!!  Within morph groups#
########################################
#
params_orig <- params # CAREFUL set original#
source("R/params_morph.R")#
head(p.morph)#
#
pars <- c("m.int", "m.slp","f.int","f.slp","g.int","g.slp","g.var", "s.int", "s.slp", "s.slp.2")#
#
p.types <- data.frame(pars, type = c("reproduction","reproduction","reproduction","reproduction","growth","growth","growth", "survival","survival","survival"))#
#
types <- unique(p.types$type)#
#
test <- NULL#
test2 <- NULL#
for (i in types) {#
#i <- "m.int"#
#i = "maturity"#
params <- params_orig #
params[,pars] <- p.morph[match(params$morphology, p.morph$morph), pars]#
pars2 <- p.types$pars[p.types$type==i]#
params[,pars2] <- params_orig[match(params$spp, params_orig$spp), pars2]#
params#
for (sp in spp) {#
	#sp <- "Ahy"#
rec.size <- params$rec.size[params$spp==sp]#
rec <- params$rec[params$spp==sp]#
h <- mesh()$h#
y <- mesh()$y#
test<-rbind(test, data.frame(spp=sp, param=i, lam=bigmatrix()$lam, morph=params$morphology[params$spp==sp], rec="normal"))#
rec <- params$rec.mean[params$spp==sp] * 2#
test2<-rbind(test2, data.frame(spp=sp, param=i, lam=bigmatrix()$lam, morph=params$morphology[params$spp==sp], rec="double"))#
 } #
}#
#
diffs <- NULL#
diffs2 <- NULL#
for (i in types) {#
	#i <- "maturity"#
	params <- params_orig #
	sub <- test[test$param==i, ]#
	params$x <- sub$lam[match(params$spp, sub$spp)]#
	diffs <- rbind(diffs, data.frame(morph=comp$morph, d=(morph.diff("x")$x.common - morph.diff("x")$x.rare), param=i, rec="normal"))#
	sub2 <- test2[test2$param==i, ]#
	params$x <- sub2$lam[match(params$spp, sub2$spp)]#
	diffs2 <- rbind(diffs2, data.frame(morph=comp$morph, d=(morph.diff("x")$x.common - morph.diff("x")$x.rare), param=i, rec="double"))#
	}#
head(diffs)#
sums <- aggregate(d~morph+rec, diffs, sum)#
sums$lamdiff <- comp$lamdiff[match(sums$morph, comp$morp)]#
#
sums2 <- aggregate(d~morph+rec, diffs2, sum)#
sums2$lamdiff <- comp$doubdiff[match(sums2$morph, comp$morp)]#
ggplot(rbind(sums,sums), aes(lamdiff, d))+geom_point(aes(col=morph, shape=rec))+#
scale_y_log10()+scale_x_log10()+#
#scale_y_sqrt()+scale_x_sqrt()+#
geom_abline(slope=1)+#
labs(x="Real lamda difference", y = "Sum of differences")#
#
ggplot()+#
geom_bar(data=diffs, aes(d, reorder(morph, -d), fill=param), stat="identity", position="stack", col="black")+#
geom_point(data=comp, aes(lamdiff, morph, col=morph), shape=4, stroke=1, size=0.5)+#
#scale_fill_manual(values=c("white",pal[c(2:3)]))+#
labs(x="Lamda difference (Common - Rare)")+#
geom_vline(xintercept=0)+#
#scale_x_sqrt()+#
guides(col="none")+scale_colour_manual(values=colsC)+#
theme_classic()+theme(axis.title.y=element_blank(), legend.title=element_blank(), legend.position=c(0.8, 0.8), legend.key.width=unit(2,"mm"), legend.key.height=unit(1,"mm"))#
########################################
# FIGURE 3#
########################################
#
source("figs/fig.3.R")#
fig.3#
#ggsave("figs/fig.3.jpg", fig.3, width=14, height=12, units="cm", dpi = 250)#
#
########################################
# REPRODUCTIVE TRADEOFF
fig4CD <- plot_grid(ggplot(diffs, aes(d, reorder(label, -d), fill=param))+#
geom_bar(stat="Identity", position="stack", col="black", size=0.2, width=0.6)+#
#geom_point(data=comp, aes(lamdiff, morph, fill=NA), shape=4)+#
#facet_wrap(~morph, nrow=2)+#
#scale_fill_manual(values=colsC)+#
scale_fill_manual(values=c("white",pal[c(2:3)]))+#
labs(x=expression(Lambda~difference~(Common~-~Rare)))+#
xlim(c(-0.02, 0.6))+#
annotation_custom(mas, mas_x+0.01, mas_x+0.13, mas_y-0.4, mas_y+0.4)+#
annotation_custom(brn, brn_x+0.05, brn_x+0.14, brn_y-0.5, brn_y+0.5)+#
annotation_custom(tab, tab_x+0.03, tab_x+0.12, tab_y-0.5, tab_y+0.5)+#
annotation_custom(cor, cor_x+0.01, cor_x+0.15, cor_y-0.5, cor_y+0.5)+#
annotation_custom(dig, dig_x+0.01, dig_x+0.15, dig_y-0.5, dig_y+0.5)+#
geom_vline(xintercept=0)+#
#scale_x_sqrt()+#
theme_classic()+theme(axis.title.y=element_blank(), legend.title=element_blank(),  legend.key.width=unit(2,"mm"), legend.key.height=unit(1,"mm"), axis.line.y=element_blank(), legend.position=c(0.8,0.8),axis.text.x=element_text(size=9),axis.text.y=element_text(size=7, angle=30), axis.title=element_text(size=9)),#
ggplot(sums, aes(lamdiff, d))+geom_abline(slope=1, size=0.1)+geom_point(aes(col=morph), size=2)+#
#scale_y_sqrt()+scale_x_sqrt()+#
labs(x=expression(~Original~lambda~difference), y = "Sum of \ndifferences")+guides(col="none")+scale_colour_manual(values=colsC)+theme_classic()+theme(axis.text=element_text(size=9),axis.title=element_text(size=9)), #
rel_widths=c(1,0.5), labels=c("C","D"), label_size=9)#
#fig4CD
fig4CD
fig4CD <- plot_grid(ggplot(diffs, aes(d, reorder(label, -d), fill=param))+#
geom_bar(stat="Identity", position="stack", col="black", size=0.2, width=0.6)+#
#geom_point(data=comp, aes(lamdiff, morph, fill=NA), shape=4)+#
#facet_wrap(~morph, nrow=2)+#
#scale_fill_manual(values=colsC)+#
scale_fill_manual(values=c("white",pal[c(2:3)]))+#
labs(x=expression(lambda~difference~(Common~-~Rare)))+#
xlim(c(-0.02, 0.6))+#
annotation_custom(mas, mas_x+0.01, mas_x+0.13, mas_y-0.4, mas_y+0.4)+#
annotation_custom(brn, brn_x+0.05, brn_x+0.14, brn_y-0.5, brn_y+0.5)+#
annotation_custom(tab, tab_x+0.03, tab_x+0.12, tab_y-0.5, tab_y+0.5)+#
annotation_custom(cor, cor_x+0.01, cor_x+0.15, cor_y-0.5, cor_y+0.5)+#
annotation_custom(dig, dig_x+0.01, dig_x+0.15, dig_y-0.5, dig_y+0.5)+#
geom_vline(xintercept=0)+#
#scale_x_sqrt()+#
theme_classic()+theme(axis.title.y=element_blank(), legend.title=element_blank(),  legend.key.width=unit(2,"mm"), legend.key.height=unit(1,"mm"), axis.line.y=element_blank(), legend.position=c(0.8,0.8),axis.text.x=element_text(size=9),axis.text.y=element_text(size=7, angle=30), axis.title=element_text(size=9)),#
ggplot(sums, aes(lamdiff, d))+geom_abline(slope=1, size=0.1)+geom_point(aes(col=morph), size=2)+#
#scale_y_sqrt()+scale_x_sqrt()+#
labs(x=expression(~Original~lambda~difference), y = "Sum of \ndifferences")+guides(col="none")+scale_colour_manual(values=colsC)+theme_classic()+theme(axis.text=element_text(size=9),axis.title=element_text(size=9)), #
rel_widths=c(1,0.5), labels=c("C","D"), label_size=9)#
#fig4CD
fig4CD <- plot_grid(ggplot(diffs, aes(d, reorder(label, -d), fill=param))+#
geom_bar(stat="Identity", position="stack", col="black", size=0.2, width=0.6)+#
#geom_point(data=comp, aes(lamdiff, morph, fill=NA), shape=4)+#
#facet_wrap(~morph, nrow=2)+#
#scale_fill_manual(values=colsC)+#
scale_fill_manual(values=c("white",pal[c(2:3)]))+#
labs(x=expression(lambda~difference~(Common~-~Rare)))+#
xlim(c(-0.02, 0.6))+#
annotation_custom(mas, mas_x+0.01, mas_x+0.13, mas_y-0.4, mas_y+0.4)+#
annotation_custom(brn, brn_x+0.05, brn_x+0.14, brn_y-0.5, brn_y+0.5)+#
annotation_custom(tab, tab_x+0.03, tab_x+0.12, tab_y-0.5, tab_y+0.5)+#
annotation_custom(cor, cor_x+0.01, cor_x+0.15, cor_y-0.5, cor_y+0.5)+#
annotation_custom(dig, dig_x+0.01, dig_x+0.15, dig_y-0.5, dig_y+0.5)+#
geom_vline(xintercept=0)+#
#scale_x_sqrt()+#
theme_classic()+theme(axis.title.y=element_blank(), legend.title=element_blank(),  legend.key.width=unit(2,"mm"), legend.key.height=unit(1,"mm"), axis.line.y=element_blank(), legend.position=c(0.8,0.8),axis.text.x=element_text(size=9),axis.text.y=element_text(size=7, angle=30), axis.title=element_text(size=9)),#
ggplot(sums, aes(lamdiff, d))+geom_abline(slope=1, size=0.1)+geom_point(aes(col=morph), size=2)+#
#scale_y_sqrt()+scale_x_sqrt()+#
labs(x=expression(~Original~lambda~difference), y = "Sum of \ndifferences")+guides(col="none")+scale_colour_manual(values=colsC)+theme_classic()+theme(axis.text=element_text(size=9),axis.title=element_text(size=9)), #
rel_widths=c(1,0.5), labels=c("C","D"), label_size=9)#
#fig4CD#
#
fig.3<- plot_grid(plot_grid(NULL, Fig4AB, rel_widths=c(0.02,1)), NULL, fig4CD, ncol=1, rel_heights=c(1,0.12, 0.7))+#
draw_label("Source of fitness differences\nwithin groups", 0.55, 0.41, size=8, fontface="bold")+#
draw_label("?", 0.63, 0.9, size=8, fontface="bold")#
fig.3
ggsave("figs/fig.3.jpg", fig.3, width=14, height=12, units="cm", dpi = 250)
rm(list = ls())#
library("ggrepel")#
library("grid")#
library("png")#
library("MASS") #
library("reshape2")#
library("ggplot2")#
library("cowplot")#
library("stats4")#
#
########################################
# LOAD DATA#
########################################
source("R/functions.R")#
source("R/data_prep.R")#
#
# remove tiny colonies (<3cm diameter)#
diam <- 3#
gdat <- subset(gdat, area > log10((pi*(diam/2)^2)/10000))#
sdat <- subset(sdat, area > log10((pi*(diam/2)^2)/10000))#
fec <- subset(fec, area > log10((pi*(diam/2)^2)/10000))#
#
sdat<-sdat[!sdat$colony_id==287,]#
gdat<-gdat[!gdat$colony_id==287,]#
#
# ordering#
#################################### #
order <- c("Ahy","Acy","Ain","Aro","Ana","Asp","Ami","Adi","Ahu", "Gre","Gpe")#
params$spp <- factor(params$spp, levels=order)#
labs <- params$species[order(params$spp)]#
cols<-as.character(params$cols)#
names(cols) <- params$spp#
cols <- cols[order]
########################################
# MODEL PARAMETERS#
########################################
source("R/params.R")
########################################
# MATURITY #
########################################
fec$reproductive <- ifelse(fec$eggs>0, 1, 0) # reproductive status#
m.int<-NULL#
m.slp<-NULL#
m.pred<-NULL#
for(sp in spp){#
	sub<-fec[fec$spp==sp,]#
	m.mod<-glm(reproductive ~ area, family="binomial", data=sub) #
	m.int<-c(m.int, coef(m.mod)[1])#
	m.slp<-c(m.slp, coef(m.mod)[2])#
	new<-data.frame(area=seq(min(sub$area), max(sub$area), 0.1), #
	  spp=sp, morph=sub$morphology[1])#
	new$pred<-predict(m.mod, new, type="response")#
	m.pred<-rbind(m.pred, new)#
}#
params$m.int<-m.int#
params$m.slp<-m.slp#
#
m.pred$spp <- factor(m.pred$spp, levels=order)#
#
########################################
# FECUNDITY  #
########################################
#
fec$f.cm2<-fec$polyps_cm2*fec$eggs  # eggs per cm2#
fec$fecundity<-round(fec$f.cm2*fec$area_cm2) # eggs per colony#
#
f.int<-NULL#
f.slp<-NULL#
f.pred<-NULL#
for(sp in spp){#
	#sp <- "Ahy"#
	sub<-fec[fec$spp==sp & fec$reproductive==1,]#
	f.mod<-glm.nb(fecundity ~ area, sub)#
	f.int<-c(f.int, coef(f.mod)[1])#
	f.slp<-c(f.slp, coef(f.mod)[2])#
	new<-data.frame(area=seq(min(sub$area), max(sub$area), 0.1),#
	spp=sp, morph=sub$morphology[1])#
	new$pred<-predict(f.mod, new, type="response")#
	f.pred<-rbind(f.pred, new)#
	}#
params$f.int<-f.int#
params$f.slp<-f.slp#
#
########################################
# FECUNDITY - CONSTANT SLOPE#
########################################
fec.con<-glm.nb(fecundity~area+spp, data=fec[fec$reproductive==1,], link = log)#
summary(fec.con)#
#
x2 <- spp # your second predictor (here, sites)#
int <-function(mod){ #
	int <- rep(coef(mod)[[1]], length(x2))#
	for (i in 2:length(x2)) { int[i] <- int[i] + coef(mod)[grepl(x2[i],#
		 names(coef(mod))) & !grepl("area", names(coef(mod)))]}#
	int} #
slp <-function(mod){ #
	slp <- rep(coef(mod)[[2]], length(x2))#
	for (i in 2:length(x2)) { slp[i] <- slp[i] + coef(mod)[grepl(x2[i],#
		names(coef(mod))) & grepl("area", names(coef(mod)))]}#
	slp} #
# input your model, output in the same order as “x2”#
params$f.int.const <- int(fec.con) # intercept = effect of x2#
params$f.int.const#
#
########################################
# GROWTH #
########################################
#
g.int<-NULL#
g.slp<-NULL#
g.var<-NULL#
g.pred<-NULL#
for(sp in spp){#
	sub<-gdat[gdat$spp==sp,]#
	g.mod<-lm(area_next ~ area, data=sub) #
	g.int<-c(g.int, coef(g.mod)[1])#
	g.slp<-c(g.slp, coef(g.mod)[2])#
	g.var<-c(g.var, var(residuals(g.mod)))#
	new<-data.frame(area=seq(min(sub$area), max(sub$area), 0.1),#
	  spp=sp, morph=sub$morphology[1])#
	new$pred<-predict(g.mod, new, type="response")#
	g.pred<-rbind(g.pred, new)#
}#
params$g.int<-g.int#
params$g.slp<-g.slp#
params$g.var<-g.var#
#
########################################
# SURVIVAL #
########################################
sdat$area_sq<-sdat$area^2#
sdat<-sdat[!is.na(sdat$surv),]#
#sdat<-sdat[sdat$area>-3,]#
s.int<-NULL#
s.slp<-NULL#
s.slp2<-NULL#
s.pred<-NULL#
#s.rec <- NULL#
for(sp in spp){#
	sub<-sdat[sdat$spp==sp,]#
	s.mod<-glm(surv ~ area, family="binomial", data=sub) #
	s.mod2<-glm(surv ~ area + area_sq, family="binomial", data=sub) #
	s.mod.c <- s.mod2#
	s.int<-c(s.int, coef(s.mod.c)[1])#
	s.slp<-c(s.slp, coef(s.mod.c)[2])#
	s.slp2<-c(s.slp2, coef(s.mod.c)[3])#
	new<-data.frame(area=seq(min(sub$area), max(sub$area), 0.1), #
	  spp=sp, morph=sub$morphology[1])#
	new$area_sq <- new$area^2#
	new$pred<-predict(s.mod.c, new, type="response")#
	#new2<-data.frame(area=params[params$spp==sp,"rec.size"], spp=sp, morph=sub$morphology[1])#
	#new2$area_sq <- new2$area^2#
	#new2$pred<-predict(s.mod2, new2, type="response")#
	#s.rec <- rbind(s.rec, new2)#
	s.pred<-rbind(s.pred, new)#
	}#
params$s.int<-s.int#
params$s.slp<-s.slp#
params$s.slp.2<-s.slp2
########################################
# MAXIMUM GROWTH  #
########################################
library("quantreg")#
gdat$radius1<-sqrt(gdat$area_cm2/pi)/100#
gdat$radius2<-sqrt(gdat$area_cm2_next/pi)/100#
gdat$g_radius<-gdat$radius2-gdat$radius1#
#
r.int<-NULL#
r.slp<-NULL#
r.err<-NULL#
r.pred<-NULL#
for(sp in spp){#
	sub<-gdat[gdat$spp==sp,]#
	r.mod <-rq(g_radius ~ 1 , data=sub, tau=0.98) # no slope#
	#r.mod <-rq(g_radius ~ area , data=sub, tau=0.99)# slope#
	r.int<-c(r.int, coef(r.mod)[1])#
	#r.slp<-c(r.slp, coef(r.mod)[2])#
	r.err <- c(r.err, summary(r.mod, se='boot')$coef[[2]])#
	new<-data.frame(area=seq(min(sub$area), max(sub$area), 0.1), #
	  spp=sp, morph=sub$morph[1])#
	new$pred<-predict(r.mod, new, type="response")#
	r.pred<-rbind(r.pred, new)#
	}#
params$r.int<-r.int#
params$r.slp<-r.slp#
params$r.err<-r.err
########################################
# PARTIAL MORTALITY  #
########################################
logit <- function(x) { log(x/(1-x)) }#
inv.logit <- function(x) { exp(x)/(1+exp(x)) }#
#
gdat$max_g<-params$r.int[match(gdat$spp, params$spp)] #
gdat$max_area2<-pi*(gdat$max_g + gdat$radius1)^2 # eq. 2.1 #
gdat$p_mort<-  1 - ((gdat$area_cm2_next/10000)/gdat$max_area2) # eq. 2.2#
gdat$p_stasis<-  1 - ((gdat$area_cm2/10000)/gdat$max_area2) #
pdat<-subset(gdat, p_mort>0.001) # less than max growth line#
#pdat<-subset(dat, p_mort>0) # zero#
pdat$pm_logit <- logit(pdat$p_mort) #
#
p.int<-NULL#
p.slp<-NULL#
p.pred<-NULL#
p.sig<-NULL#
for(sp in spp){#
	sub<-pdat[pdat$spp==sp,]#
	p.mod<-lm(pm_logit ~ area , data=sub)#
	p.int <- c(p.int, coef(p.mod)[[1]])#
	p.slp <- c(p.slp, coef(p.mod)[[2]])#
	p.sig <- c(p.sig, sigma(p.mod))#
	new<-data.frame(area=seq(min(sub$area), max(sub$area), 0.1), #
	  spp=sp, morph=sub$morph[1])#
	new$pred<-predict(p.mod, new, type="response")#
	p.pred<-rbind(p.pred, new)#
	}#
params$p.int<-p.int#
params$p.slp<-p.slp#
params$p.sig<-p.sig
fec.con<-glm.nb(fecundity~area+spp, data=fec[fec$reproductive==1,], link = log)#
summary(fec.con)#
#
x2 <- spp # your second predictor (here, sites)#
int <-function(mod){ #
	int <- rep(coef(mod)[[1]], length(x2))#
	for (i in 2:length(x2)) { int[i] <- int[i] + coef(mod)[grepl(x2[i],#
		 names(coef(mod))) & !grepl("area", names(coef(mod)))]}#
	int} #
slp <-function(mod){ #
	slp <- rep(coef(mod)[[2]], length(x2))#
	for (i in 2:length(x2)) { slp[i] <- slp[i] + coef(mod)[grepl(x2[i],#
		names(coef(mod))) & grepl("area", names(coef(mod)))]}#
	slp} #
# input your model, output in the same order as “x2”#
params$f.int.const <- int(fec.con) # intercept = effect of x2#
params$f.int.const
summary(fec.con)
summary(fec.con)
fec.con<-glm.nb(fecundity~area+spp, data=fec[fec$reproductive==1,], link = log)#
summary(fec.con)#
#
x2 <- spp # your second predictor (here, sites)#
int <-function(mod){ #
	int <- rep(coef(mod)[[1]], length(x2))#
	for (i in 2:length(x2)) { int[i] <- int[i] + coef(mod)[grepl(x2[i],#
		 names(coef(mod))) & !grepl("area", names(coef(mod)))]}#
	int} #
slp <-function(mod){ #
	slp <- rep(coef(mod)[[2]], length(x2))#
	for (i in 2:length(x2)) { slp[i] <- slp[i] + coef(mod)[grepl(x2[i],#
		names(coef(mod))) & grepl("area", names(coef(mod)))]}#
	slp} #
# input your model, output in the same order as “x2”#
params$f.int.const <- int(fec.con) # intercept = effect of x2#
params$f.int.const
# Give Gre the growth parameters of Gpe#
params[params$spp=="Gre", c("p.int", "p.slp","p.sig")] <- params[params$spp=="Gpe", c("p.int", "p.slp","p.sig")]#
params[params$spp=="Gre", c("g.int", "g.slp","g.var")] <- params[params$spp=="Gpe", c("g.int", "g.slp","g.var")]#
#
# source("figs/supp.fig1.R") # Fig S1 - demographic models#
# fig.s1#
# ggsave("figs/supp.fig1.jpg", fig.s1, width=23, height=11.5, units="cm")#
#
########################################
# MORPHOLOGICAL PAIRS#
########################################
#
# Corymbose is a group of 3#
# Remove Ana for comparisons, because it declined#
params2 <- params[!params$spp=="Ana",]#
params2$morph <- params2$morphology#
comp<-dcast(params2[!params2$spp=="Ana",], morph~abundance_pair, value.var="spp")#
comp#
#
colsC <- cols[names(cols) %in% comp$Common]#
names(colsC)<-comp$morph[match(names(colsC), comp$Common)]#
#
########################################
# DEMOGRAPHIC SPACE#
########################################
#
# 1 - total fecundity#
params$f.colony<-aggregate(fecundity~spp, fec,mean)$fecundity #
# 2 - growth (r.int)#
# 3 - proportion mortality at 100cm2#
params$p_mort<-inv.logit((params$p.slp*log10(0.01))+params$p.int)#
# 4 - fecundity per area#
params$f.cm2<-aggregate(f.cm2~spp, fec,mean)$f.cm2#
# 5 - minimum at reproductive maturity#
params$min.r<-1/aggregate(area_cm2~spp, fec[fec$reproductive==1,], min)$area_cm2#
# 6 - recruit survival, rec.cm = 15#
params$survcm<-aggregate(pred~spp, s.pred[s.pred$area<log10(pi*(15/100/2)^2),], FUN=mean)$pred#
# 7 - average modelled survival#
params$av.surv<-aggregate(pred~spp, s.pred,mean)$pred#
#
# PCA of demographic parameters#
colnames(params)#
rownames(params) <- params$spp#
traits <- c("r.int","f.cm2","survcm", "av.surv","p_mort", "min.r", "f.colony")#
pca<-prcomp(params[,traits], scale=T, center=T)#
biplot(pca)#
#
# explained variation#
exp<-round(c(summary(pca)[[1]][1]^2/sum(summary(pca)[[1]]^2),summary(pca)[[1]][2]^2/sum(summary(pca)[[1]]^2)),3)*100#
exp#
#
########################################
# ABUNDANCE#
########################################
#
abun[,c("spp","morphology","abundance_05")] <- params[match(abun$species, params$species), c("spp","morphology","abundance_05")]#
#
d08B[,c("spp","morphology","abundance_05")] <- params[match(d08B$Species, params$species), c("spp","morphology","abundance_05")]#
#
# source("figs/supp.fig2.R") # Figure S2 - abundances	#
# fig.s2#
# ggsave("figs/supp.fig2.jpg", fig.s2, width=15, height=15, units="cm")#
#
########################################
# FIGURE 1#
########################################
#
source("figs/fig.1.R")#
fig.1#
#ggsave("figs/fig.1.jpg", fig.1, width=15, height=9.5, units="cm", dpi = 300)#
#
########################################
# IPM MESH AND BOUNDARIES#
########################################
#
# repeat function to generate mesh for each species#
max.size <- 0.3 # max(ss$area)#
n <- 100#
mesh <- function(){#
	min.size <- rec.size # 3.5#
	b <- seq(min.size, max.size, length=n)#
	h <- b[2] - b[1]#
	b <- c(min(b)-(2*h), min(b)-h, b)#
	y <- 0.5 * (b[1:n]+b[2:(n+1)])#
	I <- y >= rec.size#
	return(list(b=b,h=h,y=y,I=I, rec.size = rec.size))}#
########################################
# RECRUITMENT PARAMETERS#
########################################
#
# recruit size - based on max growth, mean within groups#
agg <- aggregate(r.int~morphology, params, mean)#
params$r.int2 <- agg$r.int[match(params$morphology, agg$morphology)]#
params$rec.size <- log10(pi*(params$r.int2*0.85)^2)#
#r.limit <- 12#
#params$rec.size <- ifelse(params$rec.size>log10(pi*((r.limit/2)/100)^2),log10(pi*((r.limit/2)/100)^2), params$rec.size)#
# alternatively: *0.8 recsize without limit.#
#
# recruitment probability - same within families#
params$rec <- ifelse(params$family=="Merulinidae",0.0003162278, 0.0011364637)#
#
########################################
# PLOT IPMS#
########################################
#
# source("figs/supp/supp.fig3.R")#
# fig.s3#
# ggsave("figs/supp.fig3.jpg", fig.s3, width=20, height=10.2, units="cm")#
#
########################################
# ESTIMATE LAM#
########################################
#
lam.est <- NULL#
for (sp in spp) {#
rec.size <- params$rec.size[params$spp==sp]#
rec <- params$rec[params$spp==sp]#
h <- mesh()$h#
y <- mesh()$y#
lam.est<-rbind(lam.est, data.frame(sp, lam=bigmatrix()$lam))#
}#
params$lam.est <- lam.est$lam#
#
ggplot(params, aes(reorder(spp, -lam.est), lam.est))+geom_bar(stat="identity", aes(fill=spp))+scale_fill_manual(values=cols)+geom_hline(yintercept=1)#
#
params[,c("spp","lam.est", "g.slp")]#
#
########################################
# CHANGE IN ABUNDANCE (TRANSECTS)#
########################################
#
head(abun)#
diffs <- data.frame(dcast(abun, species+tran~year, value.var="N"))#
diffs$diff <- (diffs$X2014-diffs$X2011)#
diffs$spp<-params$spp[match(diffs$species, params$species)]#
diffs$lam <- params$lam.est[match(diffs$spp, params$spp)]#
#
ggplot(diffs, aes(reorder(spp, -lam), diff, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
scale_fill_manual(values=cols)+guides(fill="none")#
#
d.mean<-aggregate(X2011~species, diffs, mean)#
d.mean$X2014 <- aggregate(X2014~species, diffs, mean)$X2014#
d.mean$X2014 <- ifelse(d.mean$X2014==0, 0.05, d.mean$X2014)#
d.mean$X2011 <- ifelse(d.mean$X2011==0, 0.05, d.mean$X2011)#
# give absent species a small abundance (0.1)^^#
d.mean$lam.tran <- (d.mean$X2014/d.mean$X2011)^(1/3)#
d.mean#
#
params$lam.tran <- d.mean$lam.tran[match(params$species, d.mean$species)]#
#
ggplot(params, aes(lam.est, lam.tran))+geom_text(aes(label=spp))+geom_abline(slope=1)+geom_smooth(method="lm", se=F, linetype="dotted")+scale_y_log10()+scale_x_log10()#
#
summary(lm(log(lam.tran)~log(lam.est), params))#
#
# source("figs/supp.fig4.R")#
# fig.s4#
# ggsave("figs/supp.fig4.jpg", fig.s4, width=15, height=10.2, units="cm")#
########################################
# RECRUITMENT SENSITIVITY I#
#######################################	#
rec.xDET <- 10^(seq(-5,-1, 0.1))#
#
storeDET<-data.frame()#
for (sp in spp) {#
	for (rec in rec.xDET){#
	  rec.size <- params$rec.size[params$spp==sp]#
	  h <- mesh()$h#
	  y <- mesh()$y#
  sub<-dat[dat$spp==sp,]#
   mod <- bigmatrix()#
  storeDET<-rbind(storeDET, data.frame(spp=sp, rec=rec, lam=bigmatrix()$lam))#
   } #
  }#
#
ggplot(storeDET, aes(rec, lam))+geom_line(aes(col=spp))+scale_x_log10()+scale_colour_manual(values=cols)+coord_cartesian(ylim=c(0.6,2))+guides(col="none")#
#
########################################
# REC AT TRANSECT LAMS#
#######################################	#
#
rec.transect <- NULL#
for(sp in spp){#
	#sp <- "Gre"#
sub <- storeDET[storeDET$spp==sp,]#
r.sp <- params$lam.tran[params$spp==sp]#
n.rec <- which(abs(sub$lam-r.sp)==min(abs(sub$lam-r.sp)))#
if(n.rec==1){#
newlam<-	min(sub$lam)+0.01#
n.rec2 <- which(abs(sub$lam-newlam)==min(abs(sub$lam-newlam)))#
new <- sub[n.rec2,]#
} else { new <- sub[n.rec,] }#
rec.transect <- rbind(rec.transect, cbind(new, lam.r=r.sp))#
}#
#
rec.transect#
#
params$rec.tran <- rec.transect$rec[match(params$spp, rec.transect$spp)]#
#
# rec at 1... #
rec.one <- NULL#
for(sp in spp){#
sub <- storeDET[storeDET$spp==sp,]#
n.rec <- which(abs(sub$lam-1)==min(abs(sub$lam-1)))#
rec.one <- rbind(rec.one, cbind(sub[n.rec,], lam.r=r.sp))#
}#
rec.one#
params$rec.one <- rec.one$rec[match(params$spp, rec.one$spp)]#
#
########################################
# REC AT TRANSECT LAMS#
#######################################	#
#
agg.rec <- aggregate(log10(rec.tran)~family, params, mean)#
params$rec.mean <- 10^agg.rec[match(params$family, agg.rec$family),"log10(rec.tran)"]#
#params$rec.mean <- 10^mean(log10(params$rec.tran))#
#params$rec.mean <- median(params$rec.tran)#
#
r.long <- melt(params[c("spp","rec.mean", "rec.tran")])#
r.long#
#
#r.long<-r.long[!(r.long$spp=="Gpe" & r.long$variable=="rec.tran"),] #
plot_grid(#
ggplot(r.long, aes(variable, value))+#
geom_path(aes(group=spp), size=0.1)+#
#geom_jitter(aes(col=spp), height=0.05, width=0.05)+#
geom_point(aes(col=spp))+#
geom_point(data=params, aes(x="rec.mean",rec.mean))+#
geom_text(data=params[params$spp %in% c("Gre","Ahy"),], aes(x="rec.mean",rec.mean, label=family), nudge_y=0.1, nudge_x=0.2, angle=15, hjust=0, size=2)+#
scale_y_log10(limits=c(min(storeDET$rec),max(storeDET$rec)))+#
scale_colour_manual(values=cols)+#
#geom_path(aes(col=spp, group=spp))+#
coord_flip()+#
guides(col="none"), #
ggplot(storeDET, aes(rec, lam))+geom_line(aes(col=spp))+scale_x_log10(limits=c(min(storeDET$rec),max(storeDET$rec)))+#
geom_hline(yintercept=1)+#
#guides(col="none")+#
scale_colour_manual(values=cols)+coord_cartesian(ylim=c(0.6,2)),#
ncol=1, rel_heights=c(0.5,1), align="v", axis="lr")#
#
########################################
# ESTIMATE LAM#
########################################
#
lam.est <- NULL#
for (sp in spp) {#
rec.size <- params$rec.size[params$spp==sp]#
rec <- params$rec.mean[params$spp==sp]#
h <- mesh()$h#
y <- mesh()$y#
lam.est<-rbind(lam.est, data.frame(sp, lam=bigmatrix()$lam))#
}#
params$lam.est2 <- lam.est$lam#
#
#ggplot()#
#
ggplot(params, aes(reorder(spp, -lam.est2), lam.est2))+geom_bar(stat="identity", aes(fill=spp))+scale_fill_manual(values=cols)+geom_hline(yintercept=1)#
#
params[,c("spp","lam.est","lam.est2", "g.slp")]#
#
params$lam.est <- params$lam.est2#
  ######### NEW REC!!!!#
params$rec <- params$rec.mean#
#
########################################
# BOOTSTRAP#
#######################################	#
gdat_orig <- gdat#
sdat_orig <-sdat#
fec_orig <-fec#
#
#source("R/bootstap_lam.R")#
boot <- read.csv("data/lam.range.csv")#
#
ggplot(boot)+#
geom_density(aes(x=log(lam), col=spp, fill=spp), alpha=0.5)+#
geom_vline(xintercept=0, linetype="dotted")+#
#geom_point(data=params, aes(lam.est, y=0), col="grey")+#
#geom_point(data=params, aes(x=lam.est2, y=0))+#
facet_wrap(~morphology, scale="free_y", ncol=1)+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#xlim(c(0.5, 1.8))+#
#scale_x_log10(limits=c(0.5, 2))+#
theme_classic()#
#
head(boot)#
boot$GT <- log(boot$r)/log(boot$lam)#
ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0)+#
geom_point(shape=21, aes(col=spp), alpha=0.2)+#
coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+scale_x_log10()+#
geom_point(data=params, aes(GT, log(lam.est)))+guides(col="none")+#
theme_classic()#
########################################
# ELASTICITY & IPM MEASURES #
########################################
 # eigen-things combined to get sensitivity/elasticity matrices.#
#
s.list <- list()#
eK.list <- list()#
eR.list <- list()#
eP.list <- list()#
demovals <- NULL#
sizevals <- NULL#
#
for (sp in spp) {#
	#sp <- "Ahy"#
	rec <- params$rec[params$spp==sp]#
	rec.size <- params$rec.size[params$spp==sp]#
	h <- mesh()$h#
	y <- mesh()$y#
	K <- bigmatrix()$K#
	P <- bigmatrix()$P#
	R <- bigmatrix()$R#
	#image(t(K^0.2))#
	lam <- Re(eigen(K)$values[1]) # population growth#
	w.eigen<-Re(eigen(K)$vectors[,1]) # right eigenvec#
	stable.size <- w.eigen/sum(w.eigen) # sable size dist #
	v.eigen<-Re(eigen(t(K))$vectors[,1]) # left eigenvec#
	repro.val <- v.eigen/v.eigen[1] # rel. reprodutive values #
	v.dot.w<-sum(stable.size*repro.val*h) # reproductive val * stable size#
	sens<-outer(repro.val,stable.size,"*")/v.dot.w   # sensitivity matrix#
	K.elas <- sens*(K/h)/lam *h^2 # elasticity matrices (h varies)#
	P.elas<-(P/h)*sens/lam # survival elasticity matrix#
	eP=sum(P.elas)*h^2 # total survival elasticity#
	R.elas<-(R/h)*sens/lam # reproduction elasticity matrix#
	eR=sum(R.elas)*h^2 # total reproduction elasticity#
	# Net reproductive rate/Generation time from IPMbook monocarp#
	N <- solve(diag(n)-P)#
	R0 <- abs(eigen(R %*% N)$values[1])#
	GT <- log(R0)/log(lam)#
	demovals <- rbind(demovals, data.frame(spp=sp, eR, eP, R0, GT))#
	sizevals <- rbind(sizevals, data.frame(spp=sp, area=y, stable.size, repro.val, v.dot.w))#
		s.list[[sp]] <- sens#
		eR.list[[sp]] <- R.elas#
		eP.list[[sp]] <- P.elas#
		eK.list[[sp]] <- K.elas#
		}#
#
params[,colnames(demovals)]<- demovals[match(demovals$spp, params$spp),]#
lapply(eK.list, function(x){sum(x)})#
rowSums(demovals[,c("eP","eR")]) # summing to 1#
#
plot_grid(#
ggplot(sizevals, aes(x=area, y=repro.val, col=spp))+geom_line()+#
scale_colour_manual(values=cols)+#
scale_y_log10()+guides(col="none"),#
ggplot(sizevals, aes(x=area, y=stable.size, col=spp))+geom_line()+#
scale_colour_manual(values=cols)+guides(col="none"),#
ggplot(params, aes(reorder(spp, -eR), eR, fill=spp))+geom_bar(stat="identity")+scale_fill_manual(values=cols)+guides(fill="none"), #
ggplot(params, aes(reorder(spp, -R0), R0, fill=spp))+geom_bar(stat="identity")+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_log10(),#
ggplot(params, aes(reorder(spp, -GT), GT, fill=spp))+geom_bar(stat="identity")+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_log10(),#
ggplot(params, aes(r.int, eR))+geom_text(aes(label=spp))+scale_y_sqrt()+scale_x_log10())#
#
########################################
#GENERATION TIME#
#######################################	#
#
sds<-aggregate(lam~spp, boot, function(x){ quantile(x, 0.95) })#
params$lam.sd1 <- (sds$lam[match(params$spp, sds$spp)])#
sds<-aggregate(lam~spp, boot, function(x){ quantile(x, 0.05) })#
params$lam.sd2 <- (sds$lam[match(params$spp, sds$spp)])#
sds<-aggregate(lam~spp, boot, median)#
params$lam.mn <- (sds$lam[match(params$spp, sds$spp)])#
#
sds<-aggregate(GT~spp, boot, function(x){ quantile(x, 0.95) })#
params$GT.sd1 <- (sds$GT[match(params$spp, sds$spp)])#
sds<-aggregate(GT~spp, boot, function(x){ quantile(x, 0.05) })#
params$GT.sd2 <- (sds$GT[match(params$spp, sds$spp)])#
sds<-aggregate(GT~spp, boot, median)#
params$GT.mn <- (sds$GT[match(params$spp, sds$spp)])#
#
ggplot()+geom_hline(yintercept=1, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=lam.sd1, yend=lam.sd2), size=0.2)+#
geom_point(data=params,aes(GT, lam.mn, fill=spp), shape=21, stroke=0.2, size=3)+#
geom_text(data=params, aes(GT, lam.mn, label=AB), size=1.8)+#
#scale_x_log10()+#scale_y_log10()+#
scale_fill_manual(values=cols)+guides(fill="none")+#
theme_classic()#
#
########################################
# FIG 2#
#######################################	#
source("figs/fig.2.R") # check ordering#
fig.2#
#ggsave("figs/fig.2.jpg", fig.2, width=15, height=12.7, units="cm", dpi = 300)
params
source("figs/supp.fig3.R")#
#
examples1 <- #
plot_grid(NULL, plot_grid(NULL, #
plots[["Ahy"]]+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical",legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
NULL,#
plots[["Ahu"]]+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical",legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),NULL,#
#guides(col="none",fill="none")#
ncol=1, rel_heights=c(0.35,1,-0.1,1,0.1))+#
draw_label(expression(size[" "*t]~(m^2)), 0.65, 0.08, size=8, hjust=1)+#
draw_label(expression(size[" "*t+1]~(m^2)), -0.05, 0.55, size=8, angle=90)+#
draw_label("Example IPMs", 0.45, 0.95, fontface="bold", size=8)+#
draw_label(expression("("*bold(before)~bolditalic(P[rec])*")"), 0.45, 0.9, fontface="bold", size=8),#
nrow=1, rel_widths=c(0.12,1))#
examples1#
#
examples2 <- #
plot_grid(NULL,plot_grid(NULL,#
plots[["Ahy"]]+ggtitle("Ahy")+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical",legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
plots[["Ahu"]]+ggtitle("Adi")+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical", legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
nrow=1, rel_widths=c(0.2,1,1))+#
draw_label(expression(size[" "*t]~(m^2)), 0.6, 0.14, size=8, hjust=1)+#
draw_label(expression(size[" "*t+1]~(m^2)), 0.06, 0.65, size=8, angle=90)+#
draw_label(expression(bold(Example~IPMs~(before~bolditalic(P[rec])))), 0.55, 1.05, fontface="bold", size=8), nrow=2, rel_heights=c(0.15,1))#
examples2#
#
params$lam.est3 <- aggregate(lam~spp, boot, median)$lam#
params$log.lam3 <- log(params$lam.est)#
arrows2 <- dcast(params[!params$spp=="Ana", ], morphology~abundance_pair,  value.var="log.lam3")#
arrows2$Common2 <- arrows2$Common-0.03#
arrows2$Rare2 <- arrows2$Rare+0.02#
params$AB <- ifelse(params$abundance_pair=="Rare","R","C")#
params$AB[params$spp=="Ana"]<-"D"#
boot$morphology <- params$morphology[match(boot$spp, params$spp)]#
morph.ord <- c("massive","digitate","corymbose","staghorn","tabular")#
boot$morphology <- factor(boot$morphology, levels=morph.ord)#
arrows2$morphology <- factor(arrows2$morphology, levels=morph.ord)#
params$morphology <- factor(params$morphology, levels=morph.ord)#
#
#arrows2$yaxis <- c(15, 30,38,13,13)#
arrows2$yaxis <- c(38, 30,15,13,13)#
params$yaxis <- arrows2$yaxis[match(params$morphology, arrows2$morphology)]#
arrows2#
#
arrows2$diff <- arrows2$Common - arrows2$Rare#
#
lab.point <- data.frame(morphology="massive", x=c(0.2, 0.2, 0.2), y=c(30, 20, 10), lab = c('C = Common','R = Rare','D = Declined'))#
lab.point$morphology <- factor(lab.point$morphology, levels=morph.ord)#
#
params$log.lam3[params$spp=="Ana"]<-#
params$log.lam3[params$spp=="Ana"]+0.02#
params$log.lam3[params$spp=="Ami"]<-#
params$log.lam3[params$spp=="Ami"]-0.02#
lam.dens <- plot_grid(NULL, ggplot(boot)+#
geom_segment(data=arrows2, aes(x=-Inf, xend=Inf, y=yaxis*1.2, yend=yaxis*1.2), col="white")+#
geom_segment(data=arrows2, aes(y=yaxis, yend=yaxis, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
geom_text(data=lab.point, aes(x,y, label=lab), size=1.8, hjust=0, nudge_y=0.3)+#
geom_density(aes(x=log(lam), col=spp, fill=spp), alpha=0.5)+#
geom_vline(xintercept=0, linetype="dotted")+#
geom_point(data=params, aes(log.lam3, yaxis,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(log.lam3, yaxis, col=spp), size=3, alpha=0.5)+#
geom_text(data=params[!params$spp=="Ana",], aes(log.lam3, yaxis, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(log.lam3, yaxis, label="D"), size=1.8, fontface="bold")+#
#geom_hline(yintercept=0, size=1, col="white")+#
geom_hline(yintercept=-0.1, size=1, col="black")+#
#scale_y_sqrt(expand=c(0,0))+#
scale_y_continuous(expand=c(0,0))+#
#lims(x=c(min(boot$lam), max(boot$lam)))+#
ggtitle(expression(bold(Fitness)))+#
xlim(c(min(log(boot$lam)), max(log(boot$lam))-0.02))+#
coord_cartesian(xlim=c(-0.5, max(log(boot$lam))))+#
#scale_x_log10(limits=c(min(boot$lam), max(boot$lam)))+#
facet_wrap(~morphology, ncol=1, scales="free_y", strip.position="left")+#
labs(y="Density", x=expression(log(lambda)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
theme_classic()+theme(strip.text=element_blank(), strip.background=element_blank(), axis.text.y=element_blank(), axis.title.y=element_blank(), axis.line.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_text(size=8), axis.title.x=element_text(size=9),plot.title=element_text(size=8, hjust=0.5, face="bold")), nrow=1, rel_widths=c(0.1,1))#
lam.dens#
#
plot_grid(examples1, lam.dens, nrow=1, rel_widths=c(0.5, 1))#
#
r.long$label <-ifelse(r.long$variable=="rec.tran", "Transects","Constant")#
#r.long$label <- factor(r.long$label, levels=c("Fitted","Constant"))#
params$genus <- ifelse(params$family=="Acroporidae", "Acr","Gon")#
#
params$AB <- ifelse(params$abundance_pair=="Rare","R","C")#
#
arrows <- dcast(params[!params$spp=="Ana", ], morphology~abundance_pair,  value.var="rec.one")#
arrows$Common2 <- 10^(log10(arrows$Common)+0.2)#
arrows$Rare2 <- arrows$Rare#
arrows[arrows$morphology %in% c("staghorn", "tabular"),c("Rare2","Common2")] <- arrows[arrows$morphology %in% c("staghorn", "tabular"),c("Rare","Common")]#
#
arrows$diff <-   arrows$Rare/arrows$Common#
storeDET2 <- storeDET[storeDET$rec>1*10^-5 & storeDET$rec<2*10^-1,]#
#
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=min(params$rec.tran), xend=min(params$rec.tran)), col="grey85")+#
#geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=max(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey", label.size=0)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.52, yend=-0.51), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.52, yend=-0.51), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.46), label="Acr", size=2.5, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.46), label="Gon", size=2.5,col="grey")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange #
#
arrows$Common2[arrows$morphology=="tabular"] <- 9*10^-05#
arrows$Common2[arrows$morphology=="staghorn"] <- 5.5*10^-04 #
#
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete(expand=c(0.3,0.3))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot#
#
GTplot<- ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=log(lam.sd1), yend=log(lam.sd2), col=spp), size=0.5)+#
geom_segment(data=params, aes(x=GT.sd1, xend=GT.sd2, y=log(lam.mn), yend=log(lam.mn), col=spp), size=0.5)+#
geom_point(data=params, aes(GT, log(lam.mn),col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_text(data=params[params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
geom_point(data=params, aes(GT, log(lam.mn), col=spp), size=3, alpha=0.5)+#
#geom_point(shape=21, aes(col=spp), alpha=0.2)+#
#coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+#
scale_fill_manual(values=cols)+#
scale_x_log10()+#
geom_text(data=params[!params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
guides(col="none", fill="none")+#
theme_classic()+#
ggtitle("Generation times")+#
labs(x="Generation Time (years)", y=expression(log(lambda)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"), axis.title=element_text(size=9), axis.text=element_text(size=8))#
GTplot#
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
params$AB
examples1 <- #
plot_grid(NULL, plot_grid(NULL, #
plots[["Ahy"]]+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical",legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
NULL,#
plots[["Ahu"]]+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical",legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),NULL,#
#guides(col="none",fill="none")#
ncol=1, rel_heights=c(0.35,1,-0.1,1,0.1))+#
draw_label(expression(size[" "*t]~(m^2)), 0.65, 0.08, size=8, hjust=1)+#
draw_label(expression(size[" "*t+1]~(m^2)), -0.05, 0.55, size=8, angle=90)+#
draw_label("Example IPMs", 0.45, 0.95, fontface="bold", size=8)+#
draw_label(expression("("*bold(before)~bolditalic(P[rec])*")"), 0.45, 0.9, fontface="bold", size=8),#
nrow=1, rel_widths=c(0.12,1))#
examples1#
#
examples2 <- #
plot_grid(NULL,plot_grid(NULL,#
plots[["Ahy"]]+ggtitle("Ahy")+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical",legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
plots[["Ahu"]]+ggtitle("Adi")+theme(legend.position="right", plot.title=element_blank(),legend.box="vertical", legend.spacing.y=unit(0.5,"mm"), legend.margin=margin(0,0,0,-7)),#
nrow=1, rel_widths=c(0.2,1,1))+#
draw_label(expression(size[" "*t]~(m^2)), 0.6, 0.14, size=8, hjust=1)+#
draw_label(expression(size[" "*t+1]~(m^2)), 0.06, 0.65, size=8, angle=90)+#
draw_label(expression(bold(Example~IPMs~(before~bolditalic(P[rec])))), 0.55, 1.05, fontface="bold", size=8), nrow=2, rel_heights=c(0.15,1))#
examples2#
#
params$lam.est3 <- aggregate(lam~spp, boot, median)$lam#
params$log.lam3 <- log(params$lam.est)#
arrows2 <- dcast(params[!params$spp=="Ana", ], morphology~abundance_pair,  value.var="log.lam3")#
arrows2$Common2 <- arrows2$Common-0.03#
arrows2$Rare2 <- arrows2$Rare+0.02#
params$AB <- ifelse(params$abundance_pair=="Rare","R","C")#
params$AB[params$spp=="Ana"]<-"D"#
boot$morphology <- params$morphology[match(boot$spp, params$spp)]#
morph.ord <- c("massive","digitate","corymbose","staghorn","tabular")#
boot$morphology <- factor(boot$morphology, levels=morph.ord)#
arrows2$morphology <- factor(arrows2$morphology, levels=morph.ord)#
params$morphology <- factor(params$morphology, levels=morph.ord)#
#
#arrows2$yaxis <- c(15, 30,38,13,13)#
arrows2$yaxis <- c(38, 30,15,13,13)#
params$yaxis <- arrows2$yaxis[match(params$morphology, arrows2$morphology)]#
arrows2#
#
arrows2$diff <- arrows2$Common - arrows2$Rare#
#
lab.point <- data.frame(morphology="massive", x=c(0.2, 0.2, 0.2), y=c(30, 20, 10), lab = c('C = Common','R = Rare','D = Declined'))#
lab.point$morphology <- factor(lab.point$morphology, levels=morph.ord)#
#
params$log.lam3[params$spp=="Ana"]<-#
params$log.lam3[params$spp=="Ana"]+0.02#
params$log.lam3[params$spp=="Ami"]<-#
params$log.lam3[params$spp=="Ami"]-0.02#
lam.dens <- plot_grid(NULL, ggplot(boot)+#
geom_segment(data=arrows2, aes(x=-Inf, xend=Inf, y=yaxis*1.2, yend=yaxis*1.2), col="white")+#
geom_segment(data=arrows2, aes(y=yaxis, yend=yaxis, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
geom_text(data=lab.point, aes(x,y, label=lab), size=1.8, hjust=0, nudge_y=0.3)+#
geom_density(aes(x=log(lam), col=spp, fill=spp), alpha=0.5)+#
geom_vline(xintercept=0, linetype="dotted")+#
geom_point(data=params, aes(log.lam3, yaxis,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(log.lam3, yaxis, col=spp), size=3, alpha=0.5)+#
geom_text(data=params[!params$spp=="Ana",], aes(log.lam3, yaxis, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(log.lam3, yaxis, label="D"), size=1.8, fontface="bold")+#
#geom_hline(yintercept=0, size=1, col="white")+#
geom_hline(yintercept=-0.1, size=1, col="black")+#
#scale_y_sqrt(expand=c(0,0))+#
scale_y_continuous(expand=c(0,0))+#
#lims(x=c(min(boot$lam), max(boot$lam)))+#
ggtitle(expression(bold(Fitness)))+#
xlim(c(min(log(boot$lam)), max(log(boot$lam))-0.02))+#
coord_cartesian(xlim=c(-0.5, max(log(boot$lam))))+#
#scale_x_log10(limits=c(min(boot$lam), max(boot$lam)))+#
facet_wrap(~morphology, ncol=1, scales="free_y", strip.position="left")+#
labs(y="Density", x=expression(log(lambda)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
theme_classic()+theme(strip.text=element_blank(), strip.background=element_blank(), axis.text.y=element_blank(), axis.title.y=element_blank(), axis.line.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_text(size=8), axis.title.x=element_text(size=9),plot.title=element_text(size=8, hjust=0.5, face="bold")), nrow=1, rel_widths=c(0.1,1))#
lam.dens#
#
plot_grid(examples1, lam.dens, nrow=1, rel_widths=c(0.5, 1))#
#
r.long$label <-ifelse(r.long$variable=="rec.tran", "Transects","Constant")#
#r.long$label <- factor(r.long$label, levels=c("Fitted","Constant"))#
params$genus <- ifelse(params$family=="Acroporidae", "Acr","Gon")#
arrows <- dcast(params[!params$spp=="Ana", ], morphology~abundance_pair,  value.var="rec.one")#
arrows$Common2 <- 10^(log10(arrows$Common)+0.2)#
arrows$Rare2 <- arrows$Rare#
arrows[arrows$morphology %in% c("staghorn", "tabular"),c("Rare2","Common2")] <- arrows[arrows$morphology %in% c("staghorn", "tabular"),c("Rare","Common")]#
#
arrows$diff <-   arrows$Rare/arrows$Common#
storeDET2 <- storeDET[storeDET$rec>1*10^-5 & storeDET$rec<2*10^-1,]#
#
rechange <- ggplot()+geom_line(data=storeDET2, aes(rec, log(lam), col=spp))+#
scale_x_log10(limits=c(min(storeDET2$rec),max(storeDET2$rec)), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2)), size=1, col="white")+#
geom_point(data=params, aes(x=rec.mean, y=log(lam.est2), col=spp, fill=spp), size=1, alpha=0.5)+#
labs(x=expression(Recruitment~probablity~(P[rec])))+#
#geom_segment(data=NULL, aes(y=-0.55, yend=-0.55, x=min(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=min(params$rec.tran), xend=min(params$rec.tran)), col="grey85")+#
#geom_segment(data=NULL, aes(y=-0.54, yend=-0.56, x=max(params$rec.tran), xend=max(params$rec.tran)), col="grey85")+#
#geom_label(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label="range", hjust=0.65, size=2, col="grey", label.size=0)+#
geom_segment(data=params[params$family=="Acroporidae",], aes(x=rec.mean, xend=rec.mean,y=-0.52, yend=-0.51), arrow=arrow(length=unit(1, "mm") ))+#
geom_segment(data=params[params$family=="Merulinidae",], aes(x=rec.mean, xend=rec.mean,y=-0.52, yend=-0.51), arrow=arrow(length=unit(1, "mm") ))+#
geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.46), label="Acr", size=2.5, col="grey")+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=-0.46), label="Gon", size=2.5,col="grey")+#
#geom_text(data=NULL, aes(x=params$rec.mean[1], y=-0.55), label=expression(italic(P[rec])~~range), hjust=0.65, size=2, col="grey")+#
guides(col="none", fill="none")+#
theme_classic()+#
labs(x=expression(Recruitment~probablity~(P[rec])), y=expression(log(lambda)))+#
coord_cartesian(ylim=c(-0.55,0.65))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
theme( plot.background=element_blank(), axis.text=element_text(size=8), axis.title=element_text(size=9), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank())#
rechange #
#
arrows$Common2[arrows$morphology=="tabular"] <- 9*10^-05#
arrows$Common2[arrows$morphology=="staghorn"] <- 5.5*10^-04 #
#
growplot <- ggplot()+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=1, xend=Common), col="grey95", size=1)+#
geom_segment(data=arrows, aes(y=morphology, yend=morphology, x=Rare2, xend=Common2), arrow=arrow(length=unit(1, "mm")))+#
#geom_point(aes(fill=spp), shape=21, size=3, stroke=0.1)+#
geom_point(data=params, aes(rec.one, morphology,col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_point(data=params, aes(rec.one, morphology, col=spp), size=3, alpha=0.5)+#
scale_x_log10(limits=c(min(storeDET2$rec),1), breaks=c(10^-5, 10^-4,10^-3,10^-2, 10^-1), labels=c(#
		expression(10^-5), expression(10^-4), expression(10^-3),expression(10^-2), expression(10^-1)))+#
		coord_cartesian(xlim=c(min(storeDET2$rec),max(storeDET2$rec)))+#
scale_colour_manual(values=cols)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='C = Common'), size=1.8, hjust=0, nudge_y=0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='R = Rare'), size=1.8, hjust=0, nudge_y=-0.3)+#
#geom_text(data=NULL, aes(y="tabular", x=10^-2, label='D = Declined'), size=1.8, hjust=0, nudge_y=-0.9)+#
#geom_text(data=NULL, aes(y=2.5, x=min(storeDET2$rec), label="Recruitment needed\nfor population growth"), hjust=0, size=2.5)+#
theme_classic()+#
ggtitle("Recruitment vs fitness")+#
geom_text(data=params[!params$spp=="Ana",], aes(rec.one, morphology, label=AB), size=1.8, fontface="bold")+#
geom_text(data=params[params$spp=="Ana",], aes(rec.one, morphology, label="D"), size=1.8, fontface="bold")+#
scale_y_discrete(expand=c(0.3,0.3))+#
labs(x=expression(Recruitment~probablity~(P[rec])))+ #
#labs(subtitle="Recruitment needed\nfor population growth")+#
theme(plot.subtitle=element_text( size=7, hjust=1, vjust=-5), axis.title.y=element_blank(), axis.title=element_blank(),axis.text=element_blank(), plot.background=element_blank(), plot.title=element_text(size=8, hjust=0.5, face="bold"), panel.background=element_blank(), axis.line=element_blank(),axis.ticks=element_blank())#
growplot#
#
GTplot<- ggplot(boot, aes(GT, log(lam)))+#
geom_hline(yintercept=0, size=0.1)+#
geom_segment(data=params, aes(x=GT, xend=GT, y=log(lam.sd1), yend=log(lam.sd2), col=spp), size=0.5)+#
geom_segment(data=params, aes(x=GT.sd1, xend=GT.sd2, y=log(lam.mn), yend=log(lam.mn), col=spp), size=0.5)+#
geom_point(data=params, aes(GT, log(lam.mn),col=spp), shape=21, size=3, stroke=0.7, fill="white")+#
geom_text(data=params[params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
geom_point(data=params, aes(GT, log(lam.mn), col=spp), size=3, alpha=0.5)+#
#geom_point(shape=21, aes(col=spp), alpha=0.2)+#
#coord_cartesian(xlim=c(min(boot$GT),100))+#
scale_colour_manual(values=cols)+#
scale_fill_manual(values=cols)+#
scale_x_log10()+#
geom_text(data=params[!params$spp=="Adi",], aes(GT, log(lam.mn), label=AB), size=1.8, fontface="bold")+#
guides(col="none", fill="none")+#
theme_classic()+#
ggtitle("Generation times")+#
labs(x="Generation Time (years)", y=expression(log(lambda)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"), axis.title=element_text(size=9), axis.text=element_text(size=8))#
GTplot#
figCD <- plot_grid(growplot,ggplot()+theme_void(),rechange, GTplot,#
ncol=1, rel_heights=c(0.44,-0.07,1, 1), align="v", axis="lr", labels=c("B","","","D"), label_size=9)#
#figCD#
#
fig.2 <- plot_grid(plot_grid(examples2, lam.dens, nrow=2, rel_heights=c(0.45, 1), labels=c("A","C"), label_size=9),figCD, nrow=1, rel_widths=c(1,1))+#
annotation_custom(dig,0.29,0.38,0.905,0.93)+#
annotation_custom(tab,0.09,0.13,0.9,0.94)+#
annotation_custom(mas,0.05,0.13,0.56,0.59)+#
annotation_custom(dig,0.05,0.13,0.45,0.49)+#
annotation_custom(cor,0.05,0.13,0.34,0.38)+#
annotation_custom(brn,0.04,0.14,0.24,0.29)+#
annotation_custom(tab,0.06,0.12,0.125,0.155)+#
#draw_text("Recruitment needed\nfor pop. growth", 0.55, 0.895, hjust=0, size=6.5)+#
draw_label(x=0.63, y=0.89, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7)#
#draw_label(x=0.9, y=0.955, label=expression(italic(P[rec])~at~lambda>=1), hjust=0, size=7.5)#
#draw_label(x=0.655, y=0.882, label=expression((lambda>=1)), hjust=0, size=6.5)#
fig.2
ggsave("figs/fig.2.jpg", fig.2, width=15, height=12.7, units="cm", dpi = 300)
params2$lam.est <- params$lam.est[match(params2$spp, params$spp)]#
#
morph.diff <- function(x){#
	#x <-"m.int"#
	params2$x.temp <-params[match(params2$spp, params$spp), x]#
	comp$x.common <- params2$x.temp[match(comp$Common, params2$spp)]#
	comp$x.rare <- params2$x.temp[match(comp$Rare, params2$spp)]#
	comp$x.diff <- comp$x.common-comp$x.rare#
	comp$x.div <- comp$x.common/comp$x.rare#
	comp#
	}#
#
comp$AC<-morph.diff("abundance_05")$x.common#
comp$AR<-morph.diff("abundance_05")$x.rare#
comp$abundiff <- morph.diff("abundance_05")$x.div#
#
comp$lamC <- morph.diff("lam.est")$x.common#
comp$lamR <- morph.diff("lam.est")$x.rare#
comp$lamdiff <- morph.diff("lam.est")$x.diff#
comp$logdiff <- log(comp$lamC) - log(comp$lamR)#
#
# Double recruitment#
doub_lam <- NULL#
for(sp in spp){#
	rec <- params$rec[params$spp==sp] * 2#
	rec.size <- params$rec.size[params$spp==sp]#
	h <- mesh()$h#
	y <- mesh()$y#
	doub_lam <- rbind(doub_lam, data.frame(spp=sp, lam=bigmatrix()$lam))#
	}#
comp$doubC <- doub_lam$lam[match(comp$Common, doub_lam$spp)]#
comp$doubR <- doub_lam$lam[match(comp$Rare, doub_lam$spp)]#
comp$doubdiff <- comp$doubC - comp$doubR#
#
ggplot(comp)+#
geom_bar(aes(y=reorder(morph, -lamdiff), x=lamdiff), stat="identity")+#
geom_segment(aes(y=reorder(morph, -lamdiff), yend=reorder(morph, -lamdiff), x=lamdiff, xend=doubdiff), arrow=arrow(length=unit(1,"mm")))
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), diff, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=10, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_point(size=2, shape=21, stroke=0.1)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=10, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change in abundance")+#
labs(y=expression(log(lambda)~from~transects), x=expression(log(lambda)~from~IPMs))+theme(plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(0.9,0.75, 1), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(0.9,0.75, 1), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4
params
ggplot(params, aes(reorder(spp, -lam.est), rec.tran))+geom_point()
ggplot(params, aes(reorder(spp, -lam.est), rec.tran))+geom_point()+scale_x_log10()
ggplot(params, aes(reorder(spp, -lam.est), rec.tran))+geom_point()+scale_y_log10()
ggplot(params, aes(1, rec.tran))+geom_point()+scale_y_log10()
ggplot(params, aes(rec.tran, 1))+geom_point()+scale_y_log10()
ggplot(params, aes(rec.tran, 1))+geom_point()+scale_x_log10()
ggplot(params, aes(rec.tran, 1))+geom_point(aes(fill=spp))+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")
ggplot(params, aes(rec.tran, 1))+geom_point(aes(fill=spp), shape=21, stroke=0.1)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")
ggplot(params, aes(rec.tran, 1))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")
params[,c("spp","rec.tran","rec.mean")]
melt(params[,c("spp","rec.tran","rec.mean")])
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(variable, value))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, value))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+geom_line()
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+geom_line(aes(group=spp))
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+geom_line(aes(group=spp))+scale_y_reverse()
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+geom_line(aes(group=spp))+scale_y_flip()
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+geom_line(aes(group=spp))+scale_y_discrete(limits=rev)
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")++scale_y_discrete(limits=rev)
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp))+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~italic(P[rec])))
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"))+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=2)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"))+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"))+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"))+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"))+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=1, label="Acr"))
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.5, label="Acr"))
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Acr"))
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Acr"), size=1)
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Acr"), size=2)
ggplot(melt(params[,c("spp","rec.tran","rec.mean")]), aes(value, variable))+geom_line(aes(group=spp), size=0.1)+geom_point(aes(fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=2.5)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=2.5)
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=2.5)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=2.5)
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank())
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank())#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+scale_y_discrete(limits=rev)+theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(y=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(y=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.x=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(y=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2, label="Acr"), size=3)+theme(axis.title.x=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(y=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.5, label="Acr"), size=3)+theme(axis.title.x=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(y=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.x=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(y=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=2.3, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.x=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(y=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=2.3, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.y=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(y=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=2.3, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.x=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=2.3, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.x=element_blank())+coord_flip()#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=2.3, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.x=element_blank())+coord_flip()+#
ggtitle("Fitted Recruitment \nvalues")#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=2.3, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.x=element_blank(),plot.title=element_text(size=10, hjust=0.5, face="bold"))+coord_flip()+#
ggtitle("Fitted Recruitment \nvalues")#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=2.3, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.x=element_blank(),plot.title=element_text(size=10, hjust=0.5, face="bold"))+coord_flip()+#
ggtitle("Fitted & averaged \nv recruitment")#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=2.3, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.x=element_blank(),plot.title=element_text(size=10, hjust=0.5, face="bold"))+coord_flip()+#
ggtitle("Fitted & averaged \nrecruitment")#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=2.3, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.x=element_blank(),plot.title=element_text(size=10, hjust=0.5, face="bold"))+coord_flip()+#
ggtitle("Fitted vs. averaged \nrecruitment")#
recfitplot
plot_grid(fig.s4A, recfitplot, fig.s4B, fig.s4C)
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(0.9,0.75, 1), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_point(size=2, shape=21, stroke=0.1)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=10, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant \nrecruitment)")
fig.s4B
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(0.9,0.75, 1), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change in abundance")+#
labs(y=expression(log(lambda)~from~transects), x="Fitness (constant recruitment)")+theme(plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(0.9,0.75, 1), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change in abundance")+#
labs(y=expression(log(lambda)~from~transects), x=expression(lambda~(constant recruitment))+theme(plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(0.9,0.75, 1), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change in abundance")+#
labs(y=expression(log(lambda)~from~transects), x=expression(lambda~(constant recruitment)))+theme(plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(0.9,0.75, 1), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
#
#plot_grid(fig.s4A, recfitplot, fig.s4B, fig.s4C)
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change in abundance")+#
labs(y=expression(log(lambda)~from~transects), x=expression(lambda~(*constant recruitment*)))+theme(plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change in abundance")+#
labs(y=expression(log(lambda)~from~transects), x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(0.9,0.75, 1), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
#
#plot_grid(fig.s4A, recfitplot, fig.s4B, fig.s4C)
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y=expression(log(lambda)~from~transects), x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
#
#plot_grid(fig.s4A, recfitplot, fig.s4B, fig.s4C)
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in abundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
#
#plot_grid(fig.s4A, recfitplot, fig.s4B, fig.s4C)
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("","C"), label_size=12))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("","C"), ncol=1, label_size=12))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("","C"), ncol=1, label_size=12), rel_heights=c(0.5, 1))#
fig.s4
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("","C"), ncol=1, label_size=12), rel_heights=c(0.5, 1))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("","C"), ncol=1, label_size=12, rel_heights=c(0.5, 1)))#
fig.s4
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=2.3, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=2.3, label="Acr"), size=3)+theme(axis.title.x=element_blank(),plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. averaged \nrecruitment")#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.x=element_blank(),plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. averaged \nrecruitment")#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. averaged \nrecruitment")#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant \nrecruitment")#
recfitplot
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("","C"), ncol=1, label_size=12, rel_heights=c(0.5, 1)))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.5, 1)))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.7, 1)))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.7, 1)), rel_widths=c(0.8,1))#
fig.s4
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_point(size=2, shape=21, stroke=0.1)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=10, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=10, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.7, 1)), rel_widths=c(0.8,1))#
fig.s4
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), diff, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")#
#
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_point(size=2, shape=21, stroke=0.1)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.7, 1)), rel_widths=c(0.8,1))#
fig.s4
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_point(size=2, shape=21, stroke=0.1)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.7, 1)), rel_widths=c(0.8,1))#
fig.s4
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), diff, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")#
#
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="rec.mean"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="rec.mean"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_point(size=2, shape=21, stroke=0.1)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.7, 1)), rel_widths=c(0.8,1))#
fig.s4
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="constant"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="constant"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="constant"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="constant"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), diff, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")#
#
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="constant"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="constant"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_point(size=2, shape=21, stroke=0.1)+scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.7, 1)), rel_widths=c(0.8,1))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.8,1))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="constant"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="constant"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_bar(stat="identity", size=0.1)+#
#geom_point(size=2, shape=21, stroke=0.1)+#
scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_bar(stat="identity", size=0.1, col="black")+#
#geom_point(size=2, shape=21, stroke=0.1)+#
scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,1), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1.1,1), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,1.1), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
diffs
diffs$diff2 <- diffs$2014/diffs2011#
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), diff2, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="constant"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="constant"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_bar(stat="identity", size=0.1, col="black")+#
#geom_point(size=2, shape=21, stroke=0.1)+#
scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,1.1), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
diffs$diff2 <- diffs$2014/diffs$X2011#
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), diff2, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")
diffs$diff2 <- diffs$X2014/diffs$X2011
diffs$diff2 <- diffs$X2014/diffs$X2011#
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), diff2, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")#
#
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="constant"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="constant"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_bar(stat="identity", size=0.1, col="black")+#
#geom_point(size=2, shape=21, stroke=0.1)+#
scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,1.1), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
diffs$diff2 <- (diffs$X2014+0.05)/(diffs$X2011+0.05)#
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), diff2, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")#
#
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="constant"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="constant"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_bar(stat="identity", size=0.1, col="black")+#
#geom_point(size=2, shape=21, stroke=0.1)+#
scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,1.1), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
diffs$diff2 <- ((diffs$X2014+0.05)/(diffs$X2011+0.05))^(1/3)#
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), diff2, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")#
#
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="constant"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="constant"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_bar(stat="identity", size=0.1, col="black")+#
#geom_point(size=2, shape=21, stroke=0.1)+#
scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,1.1), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
diffs$diff2 <- ((diffs$X2014+0.05)/(diffs$X2011+0.05))^(1/3)#
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), log(diff2), fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")#
#
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="constant"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="constant"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_bar(stat="identity", size=0.1, col="black")+#
#geom_point(size=2, shape=21, stroke=0.1)+#
scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,1.1), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
diffs$diff2 <- ((diffs$X2014+0.05)/(diffs$X2011+0.05))^(1/3)#
fig.s4A <- ggplot(diffs, aes(reorder(spp, -lam), diff, fill=spp))+#
stat_summary(geom="bar", fun="mean", col="black", size=0.1)+#
#stat_summary(fun.data = mean_se, geom = "errorbar", width=0, size=0.2)+#
#stat_summary(aes(reorder(spp, -diff), cover, fill=spp), geom="point", fun="mean", shape=4)+#
scale_fill_manual(values=cols)+guides(fill="none")+theme_classic()+theme(axis.text.x=element_blank(), axis.title.x=element_blank(), axis.title.y=element_text(size=10),plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(Delta*N))+#
ggtitle("Change in abundance on \ntransects (2011-2014)")#
#
recfit<-melt(params[,c("spp","rec.tran","rec.mean")])#
recfit$variable2 <- ifelse(recfit$variable=="rec.mean","constant","fitted")#
recfitplot <- ggplot()+geom_line(data=recfit, aes(value, variable2, group=spp), size=0.1)+geom_point(data=recfit, aes(value, variable2, fill=spp), shape=21, stroke=0.1, size=3)+geom_point(data=NULL, aes(x=params$rec.mean[1], y="constant"), size=3)+geom_point(data=NULL, aes(x=params$rec.mean[11], y="constant"), size=3)+scale_x_log10()+scale_fill_manual(values=cols)+guides(fill="none")+#
#scale_y_discrete(limits=rev)+#
theme_classic()+labs(x=expression(Recruitment~probability~(italic(P[rec]))))+#
geom_text(data=NULL, aes(x=params$rec.mean[11], y=0.7, label="Gon"), size=3)+geom_text(data=NULL, aes(x=params$rec.mean[1], y=0.7, label="Acr"), size=3)+theme(axis.title.y=element_blank(),plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
ggtitle("Fitted vs. constant recruitment")#
recfitplot #
#
fig.s4B <-ggplot(params, aes(reorder(spp, -lam.est), log(lam.est), fill=spp))+#
geom_hline(yintercept=0)+#
geom_bar(stat="identity", size=0.1, col="black")+#
#geom_point(size=2, shape=21, stroke=0.1)+#
scale_fill_manual(values=cols)+#
guides(fill="none", col="none")+theme_classic()+theme(axis.title.x=element_blank(), axis.text.x=element_text(angle=90, vjust=0.5), axis.title.y=element_text(size=10), plot.title=element_text(size=8, hjust=0.5, face="bold"))+labs(y=expression(log(lambda)[~IPMs]))+ggtitle("Fitness (constant recruitment)")#
#
fig.s4C <-ggplot(params[params$abundance_pair %in% c("Common","Rare"),], aes(log(lam.est), log(lam.tran)))+#
geom_abline(slope=1, size=0.1)+geom_smooth(method="lm", linetype="dotted")+#
geom_point(aes(col=spp), size=3.5)+#
geom_text(aes(label=spp), size=2)+#
#scale_y_log10()+scale_x_log10()+#
theme_classic()+ggtitle("Fitness vs change \nin abundance")+#
labs(y="Change in \nabundance (2011-14)", x=expression(lambda~(constant~recruitment)))+theme(plot.title=element_text(size=8, hjust=0.5, face="bold"))+#
scale_colour_manual(values=cols)+guides(col="none")#
#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,0.9), align="v", labels=c("A","B"), label_size=12), fig.s4C,#
labels=c("","C"), label_size=12)#
fig.s4#
fig.s4 <- plot_grid(plot_grid(fig.s4A, fig.s4B, ncol=1, rel_heights=c(1,1.1), align="v", labels=c("A","C"), label_size=12), plot_grid(recfitplot,fig.s4C,#
labels=c("B","D"), ncol=1, label_size=12, rel_heights=c(0.6, 1)), rel_widths=c(0.9,1))#
fig.s4
ggsave("figs/supp.fig4.jpg", fig.s4, width=15, height=10.2, units="cm")
ggsave("figs/supp.fig4.jpg", fig.s4, width=15, height=15, units="cm")
ggsave("figs/supp.fig4.jpg", fig.s4, width=15, height=14, units="cm")
ggsave("figs/supp.fig4.jpg", fig.s4, width=15, height=13, units="cm")
########################################
# COMPARE LAMS#
########################################
#
params2$lam.est <- params$lam.est[match(params2$spp, params$spp)]#
#
morph.diff <- function(x){#
	#x <-"m.int"#
	params2$x.temp <-params[match(params2$spp, params$spp), x]#
	comp$x.common <- params2$x.temp[match(comp$Common, params2$spp)]#
	comp$x.rare <- params2$x.temp[match(comp$Rare, params2$spp)]#
	comp$x.diff <- comp$x.common-comp$x.rare#
	comp$x.div <- comp$x.common/comp$x.rare#
	comp#
	}#
#
comp$AC<-morph.diff("abundance_05")$x.common#
comp$AR<-morph.diff("abundance_05")$x.rare#
comp$abundiff <- morph.diff("abundance_05")$x.div#
#
comp$lamC <- morph.diff("lam.est")$x.common#
comp$lamR <- morph.diff("lam.est")$x.rare#
comp$lamdiff <- morph.diff("lam.est")$x.diff#
comp$logdiff <- log(comp$lamC) - log(comp$lamR)#
#
# Double recruitment#
doub_lam <- NULL#
for(sp in spp){#
	rec <- params$rec[params$spp==sp] * 2#
	rec.size <- params$rec.size[params$spp==sp]#
	h <- mesh()$h#
	y <- mesh()$y#
	doub_lam <- rbind(doub_lam, data.frame(spp=sp, lam=bigmatrix()$lam))#
	}#
comp$doubC <- doub_lam$lam[match(comp$Common, doub_lam$spp)]#
comp$doubR <- doub_lam$lam[match(comp$Rare, doub_lam$spp)]#
comp$doubdiff <- comp$doubC - comp$doubR#
#
ggplot(comp)+#
geom_bar(aes(y=reorder(morph, -lamdiff), x=lamdiff), stat="identity")+#
geom_segment(aes(y=reorder(morph, -lamdiff), yend=reorder(morph, -lamdiff), x=lamdiff, xend=doubdiff), arrow=arrow(length=unit(1,"mm")))#
#
########################################
# TIME NEEDED TO GET DIFFERENCES#
########################################
#
# method 1 #
#
comp$doub.time <- log(2)/log(1+comp$lamdiff)#
comp$difftime <- log(comp$abundiff)/log(1+comp$lamdiff)#
ggplot(comp[comp$difftime>0,], aes(x=difftime, y=reorder(morph, -difftime)))+#
geom_bar(stat="Identity", aes(fill=morph))+#
labs(x="Years to project \nabundance differences")+#
guides(fill="none")+scale_fill_manual(values=colsC)#
#
# method 2 - projecting lamda#
#
n1 <- 100#
ngen <- 100#
pars <- params2[, c("spp","morph", "abundance_pair","lam.est")]#
proj <- merge(pars, data.frame(gen=1:ngen))#
proj$n <- n1*proj$lam.est^proj$gen#
#
ggplot(proj, aes(gen, n))+geom_line(aes(group=spp, col=spp))+scale_colour_manual(values=cols)+facet_wrap(~morph, scales="free_y")#
#
ssq <- NULL#
for(i in seq(1, 50, 1)){#
Gen5 <- subset(proj, gen==i )#
params2$Gen5<-scale(Gen5$n[match(params2$spp, Gen5$spp)])#
mod <- aov(Gen5~morphology, data=params2)#
summary(mod)#
within <- summary(mod)[[1]]["Residuals","Sum Sq"]#
between <- summary(mod)[[1]]["morphology","Sum Sq"]#
ssq <- rbind(ssq, data.frame(i, within1=within, between=between, within2=(within/(within+between))))#
}#
#
plot_grid(ggplot()+geom_point(data=ssq, aes(i, within1))+geom_point(data=ssq, aes(i, between), col="red")+scale_y_log10(),#
ggplot(ssq, aes(i, within2))+geom_point() )#
#
proj2 <- dcast(morph+gen~abundance_pair, data=proj, value.var="n")#
proj2$diff <- proj2$Common/proj2$Rare#
proj2$real <- comp$abundiff[match(proj2$morph, comp$morph)]#
gens <- aggregate(gen~morph, proj2[proj2$diff<proj2$real,], max)#
proj2$maxgen <- gens$gen[match(proj2$morph, gens$morph)] +1 #to cross the line#
head(proj2)#
#
ggplot(proj2, aes(gen, diff, col=morph))+geom_line(linetype="dotted")+coord_cartesian(ylim=c(0,300))+geom_line(data=proj2[proj2$gen<=proj2$maxgen,])+geom_point(data=proj2[proj2$gen==proj2$maxgen,])#
# method 3 - projecting lamda from size dist..
